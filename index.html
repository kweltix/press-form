<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>КБ-ПРЕССФОРМА | Профессиональный калькулятор</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #0a192f;
      --primary-dark: #020c1b;
      --accent: #d4af37;
      --accent-light: #e6c76a;
      --light: #f8f9fa;
      --dark: #172a45;
      --gray: #8b98b2;
      --border: #31456e;
      --card-bg: rgba(10, 25, 47, 0.95);
      --transition: all 0.3s ease;
      --success: #27ae60;
      --error: #e74c3c;
      --match-perfect: #27ae60;
      --match-good: #f39c12;
      --match-bad: #e74c3c;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background: linear-gradient(135deg, var(--primary-dark), var(--primary));
      color: var(--light);
      line-height: 1.6;
      padding: 0;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow-x: hidden;
      font-size: 16px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      flex: 1;
      position: relative;
      z-index: 1;
    }
    
    header {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      padding: 30px 0;
      text-align: center;
      position: relative;
      overflow: hidden;
      z-index: 1;
    }
    
    header::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--accent);
    }
    
    h1 {
      font-size: 2.5rem;
      margin-bottom: 0;
      font-weight: 700;
      letter-spacing: 1px;
      background: linear-gradient(45deg, var(--accent), var(--accent-light));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      position: relative;
      display: inline-block;
      padding: 0 20px;
    }
    
    .tabs {
      display: flex;
      justify-content: center;
      margin: 20px 0 30px;
      gap: 15px;
      flex-wrap: wrap;
    }
    
    .tab-btn {
      background: rgba(23, 42, 69, 0.7);
      color: var(--accent-light);
      border: 1px solid var(--accent);
      padding: 12px 25px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
      min-width: 180px;
      text-align: center;
    }
    
    .tab-btn.active {
      background: var(--accent);
      color: var(--primary-dark);
    }
    
    .tab-btn:hover:not(.active) {
      background: rgba(212, 175, 55, 0.2);
    }
    
    .calculator-container, 
    .admin-panel,
    .converter-container {
      background: var(--card-bg);
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
      overflow: hidden;
      margin: 0 auto 30px;
      max-width: 1000px;
      position: relative;
      z-index: 1;
      border: 1px solid rgba(212, 175, 55, 0.2);
      display: none;
      padding: 25px;
    }
    
    .calculator-container.active,
    .admin-panel.active,
    .converter-container.active {
      display: block;
    }
    
    .calculator {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    
    @media (max-width: 900px) {
      .calculator {
        grid-template-columns: 1fr;
      }
    }
    
    .form-section {
      background: rgba(23, 42, 69, 0.7);
      padding: 25px;
      border-radius: 12px;
      border: 1px solid rgba(212, 175, 55, 0.15);
    }
    
    .section-title {
      font-size: 1.3rem;
      margin-bottom: 20px;
      color: var(--accent-light);
      border-bottom: 2px solid var(--accent);
      padding-bottom: 10px;
      font-weight: 600;
      display: flex;
      align-items: center;
    }
    
    .section-title i {
      margin-right: 12px;
      font-size: 1.1em;
      color: var(--accent);
    }
    
    .form-group {
      margin-bottom: 18px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--accent-light);
      font-size: 1rem;
      display: flex;
      align-items: center;
    }
    
    label i {
      margin-right: 8px;
      font-size: 0.9em;
      color: var(--accent);
    }
    
    input, select {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid rgba(212, 175, 55, 0.25);
      border-radius: 8px;
      font-size: 1rem;
      transition: var(--transition);
      background: rgba(30, 40, 60, 0.6);
      color: white;
    }
    
    input::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }
    
    input:focus, select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.3);
      background: rgba(40, 50, 70, 0.7);
    }
    
    .dimensions-group {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 12px;
    }
    
    .note {
      font-size: 0.85rem;
      color: var(--gray);
      margin-top: 6px;
      font-style: italic;
      padding-left: 26px;
    }
    
    .additional-params {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-top: 10px;
    }
    
    .btn-container {
      grid-column: 1 / -1;
      padding: 10px 0;
    }
    
    .btn-calculate {
      background: linear-gradient(135deg, var(--accent), #b8860b);
      color: white;
      border: none;
      padding: 14px 25px;
      font-size: 1.1rem;
      font-weight: 600;
      border-radius: 10px;
      cursor: pointer;
      transition: var(--transition);
      width: 100%;
      text-transform: uppercase;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .btn-calculate:hover {
      background: linear-gradient(135deg, #e6c76a, #d4af37);
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    .btn-calculate:active {
      transform: translateY(1px);
    }
    
    .btn-calculate i {
      transition: var(--transition);
    }
    
    .result-section {
      grid-column: 1 / -1;
      text-align: center;
      padding: 25px;
      display: none;
      animation: fadeIn 0.5s ease-out;
      background: rgba(23, 42, 69, 0.7);
      border-radius: 12px;
      margin-top: 10px;
      border: 1px solid rgba(212, 175, 55, 0.2);
    }
    
    .result-title {
      font-size: 1.4rem;
      color: var(--accent-light);
      margin-bottom: 20px;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .result-value {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--accent-light);
      margin: 15px 0;
      background: linear-gradient(45deg, var(--accent), var(--accent-light));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .similar-molds {
      margin-top: 25px;
      text-align: left;
    }
    
    .similar-title {
      font-size: 1.2rem;
      color: var(--accent-light);
      margin-bottom: 15px;
      border-bottom: 1px solid var(--accent);
      padding-bottom: 8px;
    }
    
    .mold-list {
      max-height: 500px;
      overflow-y: auto;
      padding-right: 10px;
    }
    
    .mold-item {
      background: rgba(23, 42, 69, 0.8);
      border-left: 3px solid var(--accent);
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 0 8px 8px 0;
      transition: all 0.3s ease;
      border-bottom: 1px solid rgba(212, 175, 55, 0.2);
    }
    
    .mold-item:hover {
      transform: translateX(5px);
      background: rgba(30, 40, 60, 0.9);
    }
    
    .param-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 6px;
      padding: 5px 8px;
      border-radius: 4px;
      font-size: 0.9rem;
    }
    
    .param-row:last-child {
      margin-bottom: 0;
    }
    
    .param-label {
      font-weight: 600;
      color: var(--accent-light);
    }
    
    .param-value {
      font-weight: 500;
    }
    
    .match-perfect {
      background-color: rgba(39, 174, 96, 0.15);
      color: var(--match-perfect);
    }
    
    .match-good {
      background-color: rgba(243, 156, 18, 0.15);
      color: var(--match-good);
    }
    
    .match-bad {
      background-color: rgba(231, 76, 60, 0.15);
      color: var(--match-bad);
    }
    
    .similarity-badge {
      background: var(--accent);
      color: var(--primary-dark);
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 0.9rem;
      font-weight: bold;
      margin-left: 10px;
    }
    
    .mold-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(212, 175, 55, 0.3);
    }
    
    .mold-title {
      font-weight: 700;
      font-size: 1.15rem;
      color: var(--accent);
    }
    
    .mold-rfq-badge {
      background: var(--accent);
      color: var(--primary-dark);
      padding: 4px 10px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 0.85rem;
    }
    
    footer {
      background: var(--primary-dark);
      color: white;
      padding: 25px 0;
      text-align: center;
      position: relative;
      z-index: 1;
      margin-top: 20px;
      border-top: 1px solid rgba(212, 175, 55, 0.2);
    }
    
    .footer-text {
      font-size: 0.95rem;
      color: var(--gray);
    }
    
    .error-message {
      background: var(--error);
      color: white;
      padding: 12px 40px 12px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: none;
      text-align: center;
      position: relative;
      animation: fadeInDown 0.3s ease-out;
    }

    .error-message.fade-out {
      animation: fadeOutUp 0.3s ease-out forwards;
    }

    .success-message {
      background: var(--success);
      color: white;
      padding: 12px 40px 12px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: none;
      text-align: center;
      position: relative;
      animation: fadeInDown 0.3s ease-out;
    }

    .close-error {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: white;
      font-size: 1.4rem;
      cursor: pointer;
      opacity: 0.8;
      transition: opacity 0.2s;
    }

    .close-error:hover {
      opacity: 1;
    }

    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeOutUp {
      from { opacity: 1; transform: translateY(0); }
      to { opacity: 0; transform: translateY(-20px); }
    }

    /* Конвертер валют */
    .converter {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .converter-section {
      background: rgba(23, 42, 69, 0.7);
      padding: 25px;
      border-radius: 12px;
      border: 1px solid rgba(212, 175, 55, 0.15);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    .converter-title {
      text-align: center;
      margin-bottom: 25px;
      color: var(--accent-light);
      font-size: 1.4rem;
      position: relative;
      padding-bottom: 15px;
    }
    
    .converter-title::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 3px;
      background: var(--accent);
      border-radius: 2px;
    }
    
    .converter-controls {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 15px;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .converter-input-group {
      position: relative;
    }
    
    .converter-input-group label {
      position: absolute;
      top: -20px;
      left: 0;
      font-size: 0.9rem;
      color: var(--accent-light);
    }
    
    .converter-input {
      width: 100%;
      padding: 14px 15px;
      border: 1px solid rgba(212, 175, 55, 0.3);
      border-radius: 8px;
      font-size: 1.1rem;
      background: rgba(30, 40, 60, 0.7);
      color: white;
      transition: var(--transition);
    }
    
    .converter-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2);
    }
    
    .converter-swap {
      background: var(--accent);
      color: var(--primary-dark);
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition);
      font-size: 1.2rem;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
    }
    
    .converter-swap:hover {
      background: var(--accent-light);
      transform: rotate(180deg) scale(1.1);
    }
    
    .converter-result {
      background: rgba(23, 42, 69, 0.9);
      padding: 25px;
      border-radius: 12px;
      text-align: center;
      font-size: 1.4rem;
      font-weight: 600;
      color: var(--accent-light);
      border: 1px solid rgba(212, 175, 55, 0.2);
      min-height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }
    
    .converter-rate {
      font-size: 0.9rem;
      color: var(--gray);
      margin-top: 10px;
      font-style: italic;
    }
    
    /* Анимация фона */
    .mold-animation {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      overflow: hidden;
      opacity: 0.08;
    }
    
    .mold-shape {
      position: absolute;
      animation: float 25s infinite linear;
      filter: drop-shadow(0 0 5px rgba(0,0,0,0.2));
      opacity: 0.7;
      z-index: 0;
      border-radius: 50%;
    }
    
    .mold-1 {
      width: 120px;
      height: 120px;
      background: radial-gradient(circle, var(--accent) 0%, transparent 70%);
      top: 15%;
      left: -50px;
      animation-delay: 0s;
      animation-duration: 35s;
    }
    
    .mold-2 {
      width: 180px;
      height: 180px;
      background: radial-gradient(circle, var(--accent) 0%, transparent 70%);
      top: 65%;
      right: -80px;
      animation-delay: 8s;
      animation-duration: 40s;
    }
    
    .mold-3 {
      width: 150px;
      height: 150px;
      background: radial-gradient(circle, var(--accent-light) 0%, transparent 70%);
      bottom: -70px;
      left: 20%;
      animation-delay: 16s;
      animation-duration: 45s;
    }
    
    .mold-4 {
      width: 100px;
      height: 100px;
      background: radial-gradient(circle, var(--accent-light) 0%, transparent 70%);
      top: 35%;
      right: 15%;
      animation-delay: 24s;
      animation-duration: 30s;
    }
    
    @keyframes float {
      0% {
        transform: translate(0, 0) rotate(0deg);
      }
      25% {
        transform: translate(100px, -150px) rotate(90deg);
      }
      50% {
        transform: translate(200px, 0) rotate(180deg);
      }
      75% {
        transform: translate(100px, 150px) rotate(270deg);
      }
      100% {
        transform: translate(0, 0) rotate(360deg);
      }
    }
    
    /* Адаптивность */
    @media (max-width: 768px) {
      h1 {
        font-size: 2rem;
      }
      
      .calculator, .admin-form {
        grid-template-columns: 1fr;
      }
      
      .tabs {
        flex-direction: column;
        align-items: center;
      }
      
      .tab-btn {
        width: 100%;
        max-width: 300px;
      }
      
      .dimensions-group, .additional-params {
        grid-template-columns: 1fr;
      }
      
      .password-container {
        flex-direction: column;
        align-items: flex-start;
        margin-top: 15px;
      }
      
      #admin-password {
        max-width: 100%;
      }
      
      .result-value {
        font-size: 2rem;
      }
      
      .converter-controls {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto auto;
      }
      
      .converter-swap {
        margin: 15px auto;
        transform: rotate(90deg);
      }
    }
    
    /* Улучшения для админ-панели */
    .password-container {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-top: 20px;
    }
    
    @media (max-width: 768px) {
      .password-container {
        margin-top: 15px;
        gap: 10px;
      }
    }
    
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    
    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: var(--accent);
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="mold-animation">
    <div class="mold-shape mold-1"></div>
    <div class="mold-shape mold-2"></div>
    <div class="mold-shape mold-3"></div>
    <div class="mold-shape mold-4"></div>
  </div>

  <header>
    <div class="container">
      <h1>КБ-ПРЕССФОРМА</h1>
      
      <div class="tabs">
        <button class="tab-btn active" data-tab="calculator">Калькулятор</button>
        <button class="tab-btn" data-tab="admin">Администрирование</button>
        <button class="tab-btn" data-tab="converter">Конвертер валют</button>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="error-message" id="error-message">
      <button class="close-error" onclick="closeErrorMessage()">&times;</button>
      <span id="error-text"></span>
    </div>
    
    <div class="success-message" id="success-message">
      <button class="close-error" onclick="closeSuccessMessage()">&times;</button>
      <span id="success-text"></span>
    </div>
    
    <!-- Калькулятор -->
    <div class="calculator-container active" id="calculator-container">
      <div class="calculator">
        <div class="form-section">
          <h3 class="section-title"><i class="fas fa-cog"></i> Основные параметры</h3>
          
          <div class="form-group">
            <label for="material"><i class="fas fa-layer-group"></i> Марка стали:</label>
            <select id="material">
              <option value="" disabled selected>Выберите материал</option>
              <option value="738H">738H</option>
              <option value="420">420</option>
              <option value="P20">P20</option>
              <option value="H13">H13</option>
              <option value="S136">S136</option>
              <option value="NAK80">NAK80</option>
              <option value="718H">718H</option>
              <option value="2316">2316</option>
            </select>
          </div>
          
          <div class="form-group">
            <label><i class="fas fa-ruler-combined"></i> Габариты (мм):</label>
            <div class="dimensions-group">
              <input type="number" id="length" min="50" max="3000" placeholder="Длина">
              <input type="number" id="width" min="50" max="3000" placeholder="Ширина">
              <input type="number" id="height" min="50" max="3000" placeholder="Высота">
            </div>
            <div class="note">Масса рассчитается автоматически</div>
          </div>
          
          <div class="form-group">
            <label for="gnezda"><i class="fas fa-th-large"></i> Число гнёзд (X×Y):</label>
            <input type="text" id="gnezda" placeholder="Например: 1×2">
            <div class="note">Укажите количество по осям X и Y</div>
          </div>
          
          <div class="form-group">
            <label for="system"><i class="fas fa-fire"></i> Тип литниковой системы:</label>
            <select id="system">
              <option value="" disabled selected>Выберите тип</option>
              <option value="горячеканальная">Горячеканальная</option>
              <option value="запорное сопло">Запорное сопло</option>
              <option value="холодноканальная">Холодноканальная</option>
              <option value="трехплитная">Трехплитная</option>
            </select>
          </div>
        </div>
        
        <div class="form-section">
          <h3 class="section-title"><i class="fas fa-sliders-h"></i> Дополнительные параметры</h3>
          
          <div class="form-group">
            <label for="polzun"><i class="fas fa-sliders"></i> Ползуны:</label>
            <select id="polzun">
              <option value="0">Нет</option>
              <option value="1">Да</option>
            </select>
          </div>
          
          <div class="additional-params">
            <div class="form-group">
              <label for="naklon"><i class="fas fa-arrows-alt-h"></i> Наклонные толкатели:</label>
              <select id="naklon">
                <option value="0">Нет</option>
                <option value="1">Да</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="vivinch"><i class="fas fa-sync-alt"></i> Вывинчивание:</label>
              <select id="vivinch">
                <option value="0">Нет</option>
                <option value="1">Да</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="sriv"><i class="fas fa-cut"></i> Срывом:</label>
              <select id="sriv">
                <option value="0">Нет</option>
                <option value="1">Да</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="vytalk"><i class="fas fa-eject"></i> Выталкивание:</label>
              <select id="vytalk">
                <option value="Одинарное">Одинарное</option>
                <option value="Двойное">Двойное</option>
              </select>
            </div>
          </div>
        </div>
        
        <div class="btn-container">
          <button class="btn-calculate" onclick="calculate()">
            <i class="fas fa-calculator"></i> РАССЧИТАТЬ СТОИМОСТЬ
          </button>
        </div>
        
        <div class="result-section" id="result">
          <div class="result-title">РАСЧЕТНАЯ СТОИМОСТЬ ПРЕСС-ФОРМЫ</div>
          <div class="result-value" id="result-value">—</div>
          
          <div class="similar-molds">
            <div class="similar-title">Похожие пресс-формы: <span class="note">(отсортированы по схожести)</span></div>
            <div class="mold-list" id="similar-molds">
              <div class="loading">
                <div class="spinner"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Панель администрирования -->
    <div class="admin-panel" id="admin-panel">
      <h3 class="section-title"><i class="fas fa-lock"></i> Редактирование базы данных</h3>
      <p class="note" style="margin-bottom: 20px; padding-left: 0;">Добавленные данные сохраняются даже после перезагрузки страницы</p>
      
      <div class="admin-form">
        <div class="form-group">
          <label for="admin-name">Наименование:</label>
          <input type="text" id="admin-name" placeholder="Например: GS.0219.0001-01">
        </div>
        
        <div class="form-group">
          <label for="admin-rfq">RFQ:</label>
          <input type="text" id="admin-rfq" placeholder="Например: 211">
        </div>
        
        <div class="form-group">
          <label for="admin-gnezda">Число гнёзд (X×Y):</label>
          <input type="text" id="admin-gnezda" placeholder="Например: 1×2">
        </div>
        
        <div class="form-group">
          <label for="admin-system">Тип системы:</label>
          <select id="admin-system">
            <option value="горячеканальная">Горячеканальная</option>
            <option value="запорное сопло">Запорное сопло</option>
            <option value="холодноканальная">Холодноканальная</option>
            <option value="трехплитная">Трехплитная</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="admin-dimensions">Габариты (мм):</label>
          <input type="text" id="admin-dimensions" placeholder="Например: 350x450x450">
        </div>
        
        <div class="form-group">
          <label for="admin-material">Марка стали:</label>
          <select id="admin-material">
            <option value="738H">738H</option>
            <option value="420">420</option>
            <option value="P20">P20</option>
            <option value="H13">H13</option>
            <option value="S136">S136</option>
            <option value="NAK80">NAK80</option>
            <option value="718H">718H</option>
            <option value="2316">2316</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="admin-polzun">Ползуны:</label>
          <select id="admin-polzun">
            <option value="0">Нет</option>
            <option value="1">Да</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="admin-naklon">Наклонные толкатели:</label>
          <select id="admin-naklon">
            <option value="0">Нет</option>
            <option value="1">Да</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="admin-vivinch">Вывинчивание:</label>
          <select id="admin-vivinch">
            <option value="0">Нет</option>
            <option value="1">Да</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="admin-sriv">Срывом:</label>
          <select id="admin-sriv">
            <option value="0">Нет</option>
            <option value="1">Да</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="admin-vytalk">Выталкивание:</label>
          <select id="admin-vytalk">
            <option value="Одинарное">Одинарное</option>
            <option value="Двойное">Двойное</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="admin-cost">Стоимость (CNY):</label>
          <input type="text" id="admin-cost" placeholder="Например: 227100">
        </div>
        
        <div class="password-container">
          <input type="password" id="admin-password" placeholder="Введите пароль">
          <button class="btn-calculate" onclick="saveToDatabase()">
            <i class="fas fa-save"></i> Сохранить в базу
          </button>
        </div>
      </div>
    </div>
    
    <!-- Конвертер валют -->
    <div class="converter-container" id="converter-container">
      <div class="converter">
        <div class="converter-section">
          <h3 class="converter-title"><i class="fas fa-exchange-alt"></i> Конвертер валют</h3>
          
          <div class="converter-controls">
            <div class="converter-input-group">
              <label for="from-amount">Сумма</label>
              <input type="number" id="from-amount" class="converter-input" placeholder="Введите сумму" min="0" step="0.01">
            </div>
            
            <button class="converter-swap" onclick="swapCurrencies()">
              <i class="fas fa-exchange-alt"></i>
            </button>
            
            <div class="converter-input-group">
              <label for="from-currency">Валюта</label>
              <select id="from-currency" class="converter-input">
                <option value="CNY">Китайский юань (CNY)</option>
                <option value="RUB">Российский рубль (RUB)</option>
              </select>
            </div>
          </div>
          
          <button class="btn-calculate" onclick="convertCurrency()">
            <i class="fas fa-sync-alt"></i> Конвертировать
          </button>
          
          <div class="converter-result" id="converter-result">
            <div>Результат конвертации</div>
            <div class="converter-rate" id="exchange-rate">Загрузка курса...</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <div class="container">
      <p class="footer-text">© 2025 КБ-ПРЕССФОРМА. Профессиональные расчеты стоимости пресс-форм.</p>
    </div>
  </footer>

  <script>
    // Плотность стали (кг/м³)
    const DENSITIES = {
      "738H": 7800,
      "420": 7700,
      "P20": 7850,
      "H13": 7800,
      "S136": 7700,
      "NAK80": 7900,
      "718H": 7800,
      "2316": 7800
    };
    
    // Веса параметров (сумма = 1.0) - вернул к предыдущим значениям
    const WEIGHTS = {
      system: 0.30,   // Тип литниковой системы (высокий вес)
      vytalk: 0.20,   // Выталкивание (высокий вес)
      polzun: 0.15,   // Ползуны (средний вес)
      vivinch: 0.15,  // Вывинчивание (средний вес)
      volume: 0.08,   // Габариты (низкий вес)
      material: 0.05, // Марка стали (низкий вес)
      naklon: 0.04,   // Наклонные толкатели (низкий вес)
      sriv: 0.03,     // Срывом (низкий вес)
      nests: 0.00     // Число гнезд (практически не влияет)
    };
    
    // Хеш пароля для админ-панели (SHA-256 от "88168" с солью "kbpress_salt_2025")
    const ADMIN_PASSWORD_HASH = "e9b7d3d96d523efd085e2b340a5a2e37f2c5a5d7e4c893882a6e2d6c1a6c8b7a";
    
    // База данных пресс-форм
    let moldsDatabase = [];
    
    // Текущий курс обмена
    let exchangeRate = 11.5;
    
    // Текущие параметры пользователя для сравнения
    let currentUserParams = null;
    
    // Защита от перебора пароля
    const failedAttempts = {
      count: 0,
      lastAttempt: 0,
      blockUntil: 0
    };
    
    // Начальные данные пресс-форм (стоимости в юанях)
    function populateInitialDatabase() {
      return [
        {
          name: "GS.0219.0001-01",
          rfq: "211",
          gnezda: "1*2",
          system: "горячеканальная",
          dimensions: [350, 450, 450],
          material: "738H",
          polzun: true,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 240000
        },
        {
          name: "GS.0514.0001",
          rfq: "211",
          gnezda: "1*1",
          system: "горячеканальная",
          dimensions: [400, 650, 620],
          material: "420",
          polzun: true,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 535000
        },
        {
          name: "GS.0514.0002",
          rfq: "211",
          gnezda: "1*4",
          system: "холодноканальная",
          dimensions: [120, 180, 170],
          material: "420",
          polzun: true,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 80000
        },
        {
          name: "1",
          rfq: "196",
          gnezda: "1*1",
          system: "горячеканальная",
          dimensions: [500, 275, 325],
          material: "420",
          polzun: true,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 58000
        },
        {
          name: "1",
          rfq: "197",
          gnezda: "1*1",
          system: "горячеканальная",
          dimensions: [450, 450, 720],
          material: "718H",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 85000
        },
        {
          name: "GS.0517.0004",
          rfq: "211",
          gnezda: "1*8",
          system: "горячеканальная",
          dimensions: [350, 550, 380],
          material: "420",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 360000
        },
        {
          name: "GS.0517.0004",
          rfq: "211",
          gnezda: "1*4",
          system: "горячеканальная",
          dimensions: [350, 350, 360],
          material: "420",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 200000
        },
        {
          name: "GS.0195.0001",
          rfq: "211",
          gnezda: "1*1",
          system: "горячеканальная",
          dimensions: [250, 500, 420],
          material: "738H",
          polzun: true,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 250000
        },
        {
          name: "212-14.13.300-01_buton",
          rfq: "198_Tula v21",
          gnezda: "1*2",
          system: "холодноканальная",
          dimensions: [325, 250, 350],
          material: "420",
          polzun: true,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 40000
        },
        {
          name: "1",
          rfq: "210_Tula",
          gnezda: "1*1",
          system: "холодноканальная",
          dimensions: [425, 300, 485],
          material: "420",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 55000
        },
        {
          name: "2",
          rfq: "210_Tula",
          gnezda: "1*2",
          system: "холодноканальная",
          dimensions: [325, 300, 350],
          material: "420",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 45000
        },
        {
          name: "2",
          rfq: "197",
          gnezda: "1*8",
          system: "холодноканальная",
          dimensions: [450, 450, 720],
          material: "718H",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 35000
        },
        {
          name: "1",
          rfq: "193",
          gnezda: "1*4",
          system: "горячеканальная",
          dimensions: [300, 400, 400],
          material: "718H",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 55000
        },
        {
          name: "1",
          rfq: "192",
          gnezda: "1*1",
          system: "горячеканальная",
          dimensions: [450, 550, 620],
          material: "H13",
          polzun: true,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 100000
        },
        {
          name: "1",
          rfq: "188",
          gnezda: "1*16",
          system: "горячеканальная",
          dimensions: [400, 400, 505],
          material: "H13",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: true,
          vytalk: "Одинарное",
          cost: 135000
        },
        {
          name: "1",
          rfq: "182",
          gnezda: "1*8",
          system: "холодноканальная",
          dimensions: [400, 450, 350],
          material: "H13",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 75000
        },
        {
          name: "2",
          rfq: "182",
          gnezda: "1*16",
          system: "холодноканальная",
          dimensions: [350, 350, 310],
          material: "H13",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 45000
        },
        {
          name: "1",
          rfq: "169",
          gnezda: "1*4",
          system: "холодноканальная",
          dimensions: [225, 225, 325],
          material: "420",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 30000
        },
        {
          name: "2",
          rfq: "169",
          gnezda: "1*1",
          system: "горячеканальная",
          dimensions: [1150, 800, 1250],
          material: "420",
          polzun: true,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 625000
        },
        {
          name: "3",
          rfq: "169",
          gnezda: "1*1",
          system: "горячеканальная",
          dimensions: [1075, 825, 1150],
          material: "420",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 570000
        },
        {
          name: "1",
          rfq: "168",
          gnezda: "1*6",
          system: "горячеканальная",
          dimensions: [500, 600, 500],
          material: "420",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: true,
          vytalk: "Двойное",
          cost: 155000
        },
        {
          name: "2",
          rfq: "168",
          gnezda: "1*8",
          system: "горячеканальная",
          dimensions: [600, 650, 500],
          material: "420",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: true,
          vytalk: "Двойное",
          cost: 195000
        },
        {
          name: "1",
          rfq: "166",
          gnezda: "1*2",
          system: "холодноканальная",
          dimensions: [250, 350, 300],
          material: "P20",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 25000
        },
        {
          name: "1",
          rfq: "165",
          gnezda: "1*2",
          system: "холодноканальная",
          dimensions: [250, 300, 300],
          material: "718H",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 22000
        },
        {
          name: "1",
          rfq: "164",
          gnezda: "1*2",
          system: "холодноканальная",
          dimensions: [300, 350, 350],
          material: "420",
          polzun: true,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 45000
        },
        {
          name: "1",
          rfq: "161",
          gnezda: "1*2",
          system: "холодноканальная",
          dimensions: [300, 300, 300],
          material: "420",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: true,
          vytalk: "Одинарное",
          cost: 35000
        },
        {
          name: "2",
          rfq: "161",
          gnezda: "1*4",
          system: "холодноканальная",
          dimensions: [300, 350, 300],
          material: "420",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: true,
          vytalk: "Одинарное",
          cost: 45000
        },
        {
          name: "3",
          rfq: "161",
          gnezda: "1*2",
          system: "холодноканальная",
          dimensions: [300, 300, 300],
          material: "420",
          polzun: true,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 30000
        },
        {
          name: "4",
          rfq: "161",
          gnezda: "1*4",
          system: "холодноканальная",
          dimensions: [300, 350, 300],
          material: "420",
          polzun: true,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 40000
        },
        {
          name: "5",
          rfq: "161",
          gnezda: "1*2",
          system: "холодноканальная",
          dimensions: [350, 400, 320],
          material: "420",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 45000
        },
        {
          name: "6",
          rfq: "161",
          gnezda: "1*4",
          system: "холодноканальная",
          dimensions: [400, 450, 330],
          material: "420",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 65000
        },
        {
          name: "1",
          rfq: "154",
          gnezda: "1*1",
          system: "горячеканальная",
          dimensions: [300, 300, 350],
          material: "718H",
          polzun: true,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 55000
        },
        {
          name: "1",
          rfq: "152",
          gnezda: "1*2",
          system: "холодноканальная",
          dimensions: [350, 450, 330],
          material: "420",
          polzun: true,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 70000
        },
        {
          name: "1",
          rfq: "151",
          gnezda: "1*4",
          system: "холодноканальная",
          dimensions: [450, 450, 400],
          material: "420",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 55000
        },
        {
          name: "1",
          rfq: "144",
          gnezda: "1*1",
          system: "холодноканальная",
          dimensions: [300, 300, 375],
          material: "H13",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 65000
        },
        {
          name: "2",
          rfq: "144",
          gnezda: "1*1",
          system: "холодноканальная",
          dimensions: [275, 275, 325],
          material: "H13",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 55000
        },
        {
          name: "3",
          rfq: "144",
          gnezda: "1*2",
          system: "холодноканальная",
          dimensions: [300, 250, 325],
          material: "H13",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 50000
        },
        {
          name: "1",
          rfq: "141",
          gnezda: "1*1",
          system: "холодноканальная",
          dimensions: [400, 400, 550],
          material: "P20",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 42000
        },
        {
          name: "2",
          rfq: "140",
          gnezda: "1*2",
          system: "холодноканальная",
          dimensions: [300, 500, 320],
          material: "H13",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 45000
        },
        {
          name: "1",
          rfq: "137",
          gnezda: "1*1",
          system: "горячеканальная",
          dimensions: [400, 450, 620],
          material: "H13",
          polzun: true,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 115000
        },
        {
          name: "1",
          rfq: "134",
          gnezda: "1*2",
          system: "холодноканальная",
          dimensions: [400, 420, 450],
          material: "H13",
          polzun: true,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 70000
        },
        {
          name: "1",
          rfq: "112",
          gnezda: "1*4",
          system: "холодноканальная",
          dimensions: [350, 500, 361],
          material: "420",
          polzun: false,
          naklon: true,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 80000
        },
        {
          name: "2",
          rfq: "112",
          gnezda: "1*4",
          system: "холодноканальная",
          dimensions: [300, 500, 381],
          material: "420",
          polzun: true,
          naklon: true,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 75000
        },
        {
          name: "1",
          rfq: "111",
          gnezda: "1*8",
          system: "холодноканальная",
          dimensions: [550, 750, 525],
          material: "2316",
          polzun: true,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 220000
        },
        // Новые пресс-формы
        {
          name: "Механические ползуны",
          rfq: "201",
          gnezda: "1*4",
          system: "холодноканальная",
          dimensions: [250, 350, 300],
          material: "420",
          polzun: true,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 41150
        },
        {
          name: "Корпус + корпус",
          rfq: "204",
          gnezda: "1*2",
          system: "холодноканальная",
          dimensions: [300, 350, 300],
          material: "718H",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 49200
        },
        {
          name: "крышка",
          rfq: "205",
          gnezda: "1*1",
          system: "горячеканальная",
          dimensions: [250, 250, 320],
          material: "718H",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: true,
          vytalk: "Двойное",
          cost: 61900
        },
        {
          name: "Кредл-вкладыш",
          rfq: "206",
          gnezda: "1*1",
          system: "холодноканальная",
          dimensions: [350, 350, 450],
          material: "P20",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 48000
        },
        {
          name: "Стакан защитный",
          rfq: "209",
          gnezda: "1*1",
          system: "холодноканальная",
          dimensions: [450, 450, 480],
          material: "H13",
          polzun: true,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 94000
        },
        {
          name: "213К-2.04.01.00_Resonator case (Part 1)",
          rfq: "210",
          gnezda: "1*1",
          system: "холодноканальная",
          dimensions: [425, 300, 485],
          material: "420",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 55000
        },
        {
          name: "Insert",
          rfq: "211",
          gnezda: "1*2",
          system: "горячеканальная",
          dimensions: [300, 450, 450],
          material: "738H",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 80000
        },
        {
          name: "Держатель",
          rfq: "212",
          gnezda: "1*4",
          system: "холодноканальная",
          dimensions: [250, 300, 320],
          material: "420",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 88140
        },
        {
          name: "Верхняя крышка",
          rfq: "213",
          gnezda: "1*1",
          system: "горячеканальная",
          dimensions: [300, 400, 330],
          material: "420",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Двойное",
          cost: 63600
        },
        {
          name: "Coil frame",
          rfq: "214",
          gnezda: "1*2",
          system: "холодноканальная",
          dimensions: [450, 450, 420],
          material: "420",
          polzun: true,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 85000
        },
        {
          name: "Корпус СМТ-smart",
          rfq: "215_НОРД",
          gnezda: "1*2",
          system: "холодноканальная",
          dimensions: [500, 550, 450],
          material: "H13",
          polzun: true,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 96500
        },
        {
          name: "СРР-225001",
          rfq: "216_Уральский трубный завод",
          gnezda: "1*1",
          system: "холодноканальная",
          dimensions: [450, 450, 450],
          material: "H13",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 53500
        },
        {
          name: "Body + Cap",
          rfq: "218 IZDELKA",
          gnezda: "1*4",
          system: "горячеканальная",
          dimensions: [500, 550, 460],
          material: "738H",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 112350
        },
        {
          name: "Antenna_cover",
          rfq: "219_Полиформ",
          gnezda: "1*4",
          system: "холодноканальная",
          dimensions: [350, 300, 300],
          material: "738H",
          polzun: true,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 35000
        },
        {
          name: "передняя панель + корпус",
          rfq: "220",
          gnezda: "1*2",
          system: "холодноканальная",
          dimensions: [400, 550, 450],
          material: "718H",
          polzun: true,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 98100
        },
        {
          name: "bottom PNT-36",
          rfq: "221",
          gnezda: "1*2",
          system: "горячеканальная",
          dimensions: [300, 450, 465],
          material: "420",
          polzun: true,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 76000
        },
        {
          name: "колесо лопастное",
          rfq: "225",
          gnezda: "1*1",
          system: "холодноканальная",
          dimensions: [350, 400, 340],
          material: "H13",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 67800
        },
        {
          name: "крышка",
          rfq: "226",
          gnezda: "1*1",
          system: "холодноканальная",
          dimensions: [500, 500, 400],
          material: "H13",
          polzun: true,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 132210
        },
        {
          name: "Panel2 v40_1",
          rfq: "228",
          gnezda: "1*1",
          system: "холодноканальная",
          dimensions: [350, 500, 350],
          material: "420",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 71200
        },
        {
          name: "крышка",
          rfq: "230",
          gnezda: "1*1",
          system: "холодноканальная",
          dimensions: [400, 400, 400],
          material: "H13",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 86450
        },
        {
          name: "1",
          rfq: "232 Metallico",
          gnezda: "1*6",
          system: "холодноканальная",
          dimensions: [350, 550, 350],
          material: "H13",
          polzun: true,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 94920
        },
        {
          name: "blade LEFT + blade RIGHT",
          rfq: "234",
          gnezda: "1*2",
          system: "горячеканальная",
          dimensions: [600, 1000, 670],
          material: "H13",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 253900
        },
        {
          name: "Floor brush ГПС-96.013",
          rfq: "235_Brush",
          gnezda: "2",
          system: "холодноканальная",
          dimensions: [350, 500, 350],
          material: "420H",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: true,
          vytalk: "Одинарное",
          cost: 39500
        },
        {
          name: "булавка",
          rfq: "236",
          gnezda: "1*2",
          system: "холодноканальная",
          dimensions: [285, 275, 300],
          material: "P20",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 38000
        },
        {
          name: "Keyboard-2; Bracket",
          rfq: "238_АО «Завод им. Козицкого»",
          gnezda: "1*4",
          system: "холодноканальная",
          dimensions: [400, 450, 400],
          material: "420",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 49000
        },
        {
          name: "Заглушка 800",
          rfq: "241_АО ВНИИР-Прогресс",
          gnezda: "1*6",
          system: "холодноканальная",
          dimensions: [300, 350, 300],
          material: "H13",
          polzun: false,
          naklon: false,
          vivinch: true,
          sriv: false,
          vytalk: "Одинарное",
          cost: 32000
        },
        {
          name: "заглушка 21 + заглушка 41",
          rfq: "242",
          gnezda: "1*4",
          system: "холодноканальная",
          dimensions: [300, 300, 300],
          material: "738H",
          polzun: false,
          naklon: false,
          vivinch: true,
          sriv: false,
          vytalk: "Одинарное",
          cost: 28000
        },
        {
          name: "Угловой соединитель 45x45 45 серия",
          rfq: "243",
          gnezda: "1*4",
          system: "холодноканальная",
          dimensions: [450, 500, 400],
          material: "H13",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 60000
        },
        {
          name: "Якорь",
          rfq: "247",
          gnezda: "1*4",
          system: "холодноканальная",
          dimensions: [350, 350, 300],
          material: "H13",
          polzun: false,
          naklon: false,
          vivinch: true,
          sriv: false,
          vytalk: "Одинарное",
          cost: 31500
        },
        {
          name: "резиновая прокладка -АГ4С",
          rfq: "249",
          gnezda: "1*1",
          system: "холодноканальная",
          dimensions: [250, 250, 300],
          material: "H13",
          polzun: false,
          naklon: false,
          vivinch: false,
          sriv: false,
          vytalk: "Одинарное",
          cost: 44000
        }
      ];
    }
    
    // Сохранение базы данных в localStorage
    function saveDatabase() {
      localStorage.setItem('moldsDatabase', JSON.stringify(moldsDatabase));
    }
    
    // Обновление курса валют
    async function updateExchangeRate() {
      try {
        document.getElementById('exchange-rate').innerHTML = 
          '<i class="fas fa-spinner fa-spin"></i> Обновление курса...';
        
        const response = await fetch('https://api.exchangerate-api.com/v4/latest/CNY');
        
        if (!response.ok) throw new Error('Ошибка сети');
        
        const data = await response.json();
        
        if (data && data.rates && data.rates.RUB) {
          exchangeRate = data.rates.RUB;
          localStorage.setItem('exchangeRate', exchangeRate);
          localStorage.setItem('exchangeRateTimestamp', Date.now());
          updateRateDisplay();
        } else {
          throw new Error('Неверный формат ответа');
        }
      } catch (error) {
        console.error('Ошибка при получении курса:', error);
        const savedRate = localStorage.getItem('exchangeRate');
        const savedTimestamp = localStorage.getItem('exchangeRateTimestamp');
        
        if (savedRate && savedTimestamp) {
          // Используем кэш, если он не старше 6 часов
          const age = Date.now() - parseInt(savedTimestamp);
          if (age < 6 * 60 * 60 * 1000) {
            exchangeRate = parseFloat(savedRate);
            updateRateDisplay();
            showError(`Используем кэш. Ошибка: ${error.message}`);
            return;
          }
        }
        document.getElementById('exchange-rate').textContent = 
          'Ошибка загрузки курса. Попробуйте позже';
      }
    }
    
    function updateRateDisplay() {
      document.getElementById('exchange-rate').innerHTML = `
        Текущий курс: 1 CNY = ${exchangeRate.toFixed(2)} RUB
        <br><small>Обновлено: ${new Date().toLocaleTimeString()}</small>
      `;
    }

    // Переключение вкладок
    document.querySelectorAll('.tab-btn').forEach(button => {
      button.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        
        document.getElementById('calculator-container').classList.remove('active');
        document.getElementById('admin-panel').classList.remove('active');
        document.getElementById('converter-container').classList.remove('active');
        
        if(button.dataset.tab === 'calculator') {
          document.getElementById('calculator-container').classList.add('active');
        } else if(button.dataset.tab === 'admin') {
          document.getElementById('admin-panel').classList.add('active');
        } else if(button.dataset.tab === 'converter') {
          document.getElementById('converter-container').classList.add('active');
          updateExchangeRate();
        }
      });
    });

    function closeErrorMessage() {
      const errorElement = document.getElementById('error-message');
      errorElement.classList.add('fade-out');
      setTimeout(() => {
        errorElement.style.display = 'none';
        errorElement.classList.remove('fade-out');
      }, 300);
    }
    
    function closeSuccessMessage() {
      const successElement = document.getElementById('success-message');
      successElement.classList.add('fade-out');
      setTimeout(() => {
        successElement.style.display = 'none';
        successElement.classList.remove('fade-out');
      }, 300);
    }

    function showError(message) {
      const errorElement = document.getElementById('error-message');
      const errorText = document.getElementById('error-text');
      
      errorText.textContent = message;
      errorElement.style.display = 'block';
      
      setTimeout(closeErrorMessage, 5000);
    }
    
    function showSuccess(message) {
      const successElement = document.getElementById('success-message');
      const successText = document.getElementById('success-text');
      
      successText.textContent = message;
      successElement.style.display = 'block';
      
      setTimeout(closeSuccessMessage, 5000);
    }

    // Расчет схожести с учетом требований
    function calculateSimilarity(mold, params) {
      // Группы материалов
      const materialGroups = {
        basic: ["738H", "718H", "420", "P20"],
        premium: ["H13", "S136", "NAK80", "2316"]
      };

      // Расчет объема
      const moldVolume = mold.dimensions[0] * mold.dimensions[1] * mold.dimensions[2];
      const paramVolume = params.dimensions[0] * params.dimensions[1] * params.dimensions[2];
      
      // Сравнение объема
      const volumeDiff = Math.abs(moldVolume - paramVolume) / Math.max(moldVolume, paramVolume, 1);
      const volumeSimilarity = 100 * (1 - Math.min(volumeDiff, 1));

      // Сравнение системы
      const systemMatch = mold.system === params.system ? 100 : 0;

      // Сходство материала
      let materialSimilarity;
      if (mold.material === params.material) {
        materialSimilarity = 100;
      } else if (
        materialGroups.basic.includes(mold.material) && 
        materialGroups.basic.includes(params.material)
      ) {
        materialSimilarity = 80;
      } else if (
        materialGroups.premium.includes(mold.material) && 
        materialGroups.premium.includes(params.material)
      ) {
        materialSimilarity = 80;
      } else {
        materialSimilarity = 40;
      }

      // Ползуны
      let polzunMatch;
      if (params.polzun) {
        polzunMatch = mold.polzun ? 100 : 0;
      } else {
        polzunMatch = mold.polzun ? 30 : 100;
      }
      
      // Вывинчивание
      let vivinchMatch;
      if (params.vivinch) {
        vivinchMatch = mold.vivinch ? 100 : 0;
      } else {
        vivinchMatch = mold.vivinch ? 30 : 100;
      }
      
      // Выталкивание
      const vytalkMatch = mold.vytalk === params.vytalk ? 100 : 0;
      
      // Наклонные толкатели
      let naklonMatch;
      if (mold.naklon === params.naklon) {
        naklonMatch = 100;
      } else {
        naklonMatch = 50;
      }
      
      // Срывом
      let srivMatch;
      if (mold.sriv === params.sriv) {
        srivMatch = 100;
      } else {
        srivMatch = 50;
      }
      
      // Число гнезд (не влияет)
      const nestsMatch = 100;

      // Общая схожесть (взвешенная сумма)
      let totalSimilarity = 
        volumeSimilarity * WEIGHTS.volume +
        systemMatch * WEIGHTS.system +
        materialSimilarity * WEIGHTS.material +
        polzunMatch * WEIGHTS.polzun +
        vivinchMatch * WEIGHTS.vivinch +
        vytalkMatch * WEIGHTS.vytalk +
        naklonMatch * WEIGHTS.naklon +
        srivMatch * WEIGHTS.sriv +
        nestsMatch * WEIGHTS.nests;

      return Math.min(100, Math.max(0, Math.round(totalSimilarity)));
    }

    // Поиск похожих пресс-форм
    function findSimilarMolds(params) {
      // Преобразуем гнезда в число
      const moldsWithSimilarity = moldsDatabase.map(mold => {
        const similarity = calculateSimilarity(mold, params);
        return { ...mold, similarity };
      });

      // Фильтрация по булевым параметрам
      const filteredMolds = moldsWithSimilarity.filter(mold => {
        if (params.polzun && !mold.polzun) return false;
        if (params.vivinch && !mold.vivinch) return false;
        return true;
      });

      // Сортировка по убыванию схожести
      filteredMolds.sort((a, b) => b.similarity - a.similarity);

      return filteredMolds.slice(0, 10);
    }

    // Расчет стоимости по схожести
    function calculateCostBySimilarity(similarMolds, minSimilarity = 65) {
      // Фильтрация по минимальной схожести
      const filtered = similarMolds.filter(m => m.similarity >= minSimilarity);
      
      if (filtered.length === 0) return null;
      
      // Группировка по кластерам схожести
      const clusters = {
        high: filtered.filter(m => m.similarity >= 85),
        medium: filtered.filter(m => m.similarity >= 70 && m.similarity < 85),
        low: filtered.filter(m => m.similarity >= 65 && m.similarity < 70)
      };
      
      // Вес кластеров
      const clusterWeights = {
        high: 3,
        medium: 2,
        low: 1
      };
      
      // Расчет медианной стоимости для кластера
      const medianCost = cluster => {
        if (cluster.length === 0) return null;
        const sorted = [...cluster].sort((a, b) => a.cost - b.cost);
        const mid = Math.floor(sorted.length / 2);
        return sorted.length % 2 !== 0 
          ? sorted[mid].cost 
          : (sorted[mid - 1].cost + sorted[mid].cost) / 2;
      };
      
      // Взвешенное объединение кластеров
      let totalCost = 0;
      let totalWeight = 0;
      
      for (const [level, molds] of Object.entries(clusters)) {
        if (molds.length === 0) continue;
        
        const clusterMedian = medianCost(molds);
        const weight = clusterWeights[level] * molds.length;
        
        totalCost += clusterMedian * weight;
        totalWeight += weight;
      }
      
      // Возвращаем взвешенную медиану
      return Math.round(totalCost / totalWeight);
    }
    
    // Fallback расчет
    function fallbackCalculation(params) {
      // Находим среднюю стоимость/объем в базе
      const volumeCosts = moldsDatabase.map(m => {
        const v = m.dimensions[0] * m.dimensions[1] * m.dimensions[2];
        return m.cost / v;
      });
      
      const avgCostPerVolume = volumeCosts.reduce((sum, val) => sum + val, 0) / volumeCosts.length;
      
      // Расчет объема
      const volume = params.dimensions[0] * params.dimensions[1] * params.dimensions[2];
      let cost = volume * avgCostPerVolume;
      
      // Коэффициенты материала
      const materialFactors = {
        "738H": 1.0, "420": 1.0, "P20": 1.1, 
        "H13": 1.3, "S136": 1.5, "NAK80": 1.6, 
        "718H": 1.2, "2316": 1.4
      };
      
      // Коэффициенты системы
      const systemFactors = {
        "холодноканальная": 1.0,
        "запорное сопло": 1.2,
        "горячеканальная": 1.4,
        "трехплитная": 1.5
      };
      
      // Применяем коэффициенты
      cost *= materialFactors[params.material] || 1.3;
      cost *= systemFactors[params.system] || 1.2;
      
      // Доплаты за сложность
      if (params.polzun) cost *= 1.25;
      if (params.vivinch) cost *= 1.3;
      if (params.vytalk === "Двойное") cost *= 1.15;
      
      return Math.round(cost);
    }

    // Отображение похожих пресс-форм
    function showSimilarMolds(similarMolds, userParams) {
      const similarList = document.getElementById('similar-molds');
      
      if (similarMolds.length === 0) {
        similarList.innerHTML = '<div class="mold-item">Нет похожих пресс-форм в базе данных</div>';
        return;
      }

      similarList.innerHTML = '';
      
      similarMolds.forEach(mold => {
        // Определяем классы для подсветки
        const moldVolume = mold.dimensions[0] * mold.dimensions[1] * mold.dimensions[2];
        const userVolume = userParams.dimensions[0] * userParams.dimensions[1] * userParams.dimensions[2];
        const volumeDiff = Math.abs(moldVolume - userVolume) / Math.max(moldVolume, userVolume, 1);
        
        let volumeClass = 'match-bad';
        if (volumeDiff <= 0.1) volumeClass = 'match-perfect';
        else if (volumeDiff <= 0.3) volumeClass = 'match-good';
        
        const systemClass = mold.system === userParams.system ? 'match-perfect' : 'match-bad';
        const materialClass = mold.material === userParams.material ? 'match-perfect' : 
                            (mold.material[0] === userParams.material[0] ? 'match-good' : 'match-bad');
        const polzunClass = mold.polzun === userParams.polzun ? 'match-perfect' : 'match-bad';
        const vivinchClass = mold.vivinch === userParams.vivinch ? 'match-perfect' : 'match-bad';
        const vytalkClass = mold.vytalk === userParams.vytalk ? 'match-perfect' : 'match-bad';
        const naklonClass = mold.naklon === userParams.naklon ? 'match-perfect' : 'match-bad';
        const srivClass = mold.sriv === userParams.sriv ? 'match-perfect' : 'match-bad';
        
        const moldEl = document.createElement('div');
        moldEl.className = 'mold-item';
        moldEl.innerHTML = `
          <div class="mold-header">
            <div class="mold-title">${mold.name}</div>
            <div class="mold-rfq-badge">RFQ: ${mold.rfq}</div>
            <span class="similarity-badge">${mold.similarity}%</span>
          </div>
          
          <div class="param-row ${volumeClass}">
            <span class="param-label">Габариты:</span>
            <span class="param-value">${mold.dimensions.join('×')} мм</span>
          </div>
          
          <div class="param-row ${systemClass}">
            <span class="param-label">Тип системы:</span>
            <span class="param-value">${mold.system}</span>
          </div>
          
          <div class="param-row ${materialClass}">
            <span class="param-label">Марка стали:</span>
            <span class="param-value">${mold.material}</span>
          </div>
          
          <div class="param-row ${polzunClass}">
            <span class="param-label">Ползуны:</span>
            <span class="param-value">${mold.polzun ? 'Да' : 'Нет'}</span>
          </div>
          
          <div class="param-row ${vivinchClass}">
            <span class="param-label">Вывинчивание:</span>
            <span class="param-value">${mold.vivinch ? 'Да' : 'Нет'}</span>
          </div>
          
          <div class="param-row ${vytalkClass}">
            <span class="param-label">Выталкивание:</span>
            <span class="param-value">${mold.vytalk}</span>
          </div>
          
          <div class="param-row ${naklonClass}">
            <span class="param-label">Наклонные толкатели:</span>
            <span class="param-value">${mold.naklon ? 'Да' : 'Нет'}</span>
          </div>
          
          <div class="param-row ${srivClass}">
            <span class="param-label">Срывом:</span>
            <span class="param-value">${mold.sriv ? 'Да' : 'Нет'}</span>
          </div>
          
          <div class="param-row">
            <span class="param-label">Стоимость:</span>
            <span class="param-value" style="color: var(--accent); font-weight: 600;">${mold.cost.toLocaleString('ru-RU')} CNY</span>
          </div>
        `;
        similarList.appendChild(moldEl);
      });
    }

    function calculate() {
      // Сбор данных
      const material = document.getElementById('material').value;
      const length = parseFloat(document.getElementById('length').value);
      const width = parseFloat(document.getElementById('width').value);
      const height = parseFloat(document.getElementById('height').value);
      const gnezdaInput = document.getElementById('gnezda').value.trim();
      const system = document.getElementById('system').value;
      const polzun = document.getElementById('polzun').value === '1';
      const naklon = document.getElementById('naklon').value === '1';
      const vivinch = document.getElementById('vivinch').value === '1';
      const sriv = document.getElementById('sriv').value === '1';
      const vytalk = document.getElementById('vytalk').value;

      // Проверка заполненности
      if (!material || isNaN(length) || isNaN(width) || isNaN(height) || !gnezdaInput || !system) {
        showError('Заполните все обязательные поля!');
        return;
      }

      // Проверка габаритов
      if (length < 50 || width < 50 || height < 50 || length > 3000 || width > 3000 || height > 3000) {
        showError('Габариты должны быть в диапазоне 50-3000 мм!');
        return;
      }

      // Разбираем число гнезд
      let gnezdaParts;
      if (gnezdaInput.includes('×') || gnezdaInput.includes('x') || gnezdaInput.includes('*')) {
        const separator = gnezdaInput.includes('×') ? '×' : 
                         gnezdaInput.includes('x') ? 'x' : '*';
        gnezdaParts = gnezdaInput.split(separator);
      } else {
        showError('Введите число гнезд в формате: X×Y');
        return;
      }

      if (gnezdaParts.length !== 2) {
        showError('Введите число гнезд в формате: X×Y');
        return;
      }

      const x = parseInt(gnezdaParts[0]);
      const y = parseInt(gnezdaParts[1]);
      if (isNaN(x) || isNaN(y)) {
        showError('Введите число гнезд в формате: X×Y');
        return;
      }

      const totalNests = x * y;

      // Параметры пользователя
      const userParams = {
        material,
        dimensions: [length, width, height],
        gnezda: `${x}*${y}`,
        system,
        polzun,
        naklon,
        vivinch,
        sriv,
        vytalk,
        totalNests
      };
      
      // Сохраняем для сравнения
      currentUserParams = userParams;

      // Проверка на точное совпадение
      let exactMatchCost = null;
      for (const mold of moldsDatabase) {
        const sameDimensions = 
          mold.dimensions[0] === length &&
          mold.dimensions[1] === width &&
          mold.dimensions[2] === height;
        
        const sameMaterial = mold.material === material;
        const sameSystem = mold.system === system;
        const samePolzun = mold.polzun === polzun;
        const sameNaklon = mold.naklon === naklon;
        const sameVivinch = mold.vivinch === vivinch;
        const sameSriv = mold.sriv === sriv;
        const sameVytalk = mold.vytalk === vytalk;
        const sameGnezda = mold.gnezda === `${x}*${y}`;
        
        if (sameDimensions && sameMaterial && sameSystem && samePolzun && 
            sameNaklon && sameVivinch && sameSriv && sameVytalk && sameGnezda) {
          exactMatchCost = mold.cost;
          break;
        }
      }

      // Если найдено точное совпадение
      if (exactMatchCost !== null) {
        // Округление до 10000
        exactMatchCost = Math.round(exactMatchCost / 10000) * 10000;
        
        document.getElementById('result-value').textContent = 
          exactMatchCost.toLocaleString('ru-RU') + ' CNY';
        
        document.getElementById('result').style.display = 'block';
        showSuccess('Найдено точное совпадение в базе данных!');
        
        // Показываем похожие пресс-формы
        const similarMolds = findSimilarMolds(userParams);
        showSimilarMolds(similarMolds, userParams);
        return;
      }

      // Найти похожие пресс-формы
      const similarMolds = findSimilarMolds(userParams);

      // Рассчитать стоимость по схожести
      const similarityCost = calculateCostBySimilarity(similarMolds);
      
      let finalCost;
      if (similarityCost !== null) {
        finalCost = similarityCost;
      } else {
        // Fallback расчет
        finalCost = fallbackCalculation(userParams);
      }

      // Округление до 10000
      finalCost = Math.round(finalCost / 10000) * 10000;

      // Показать результат
      document.getElementById('result-value').textContent = 
        finalCost.toLocaleString('ru-RU') + ' CNY';
      
      // Показать похожие пресс-формы
      showSimilarMolds(similarMolds, userParams);

      // Показать блок с результатом
      document.getElementById('result').style.display = 'block';
    }
    
    // Сохранение в базу данных
    async function saveToDatabase() {
      // Проверка блокировки
      if (Date.now() < failedAttempts.blockUntil) {
        const minsLeft = Math.ceil((failedAttempts.blockUntil - Date.now()) / 60000);
        showError(`Слишком много попыток. Попробуйте через ${minsLeft} мин.`);
        return;
      }

      const password = document.getElementById('admin-password').value;
      
      // Хеширование введенного пароля
      const encoder = new TextEncoder();
      const data = encoder.encode(password + "kbpress_salt_2025");
      const hashBuffer = await crypto.subtle.digest('SHA-256', data);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      const inputHash = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
      
      if (inputHash !== ADMIN_PASSWORD_HASH) {
        // Логика блокировки
        failedAttempts.count++;
        failedAttempts.lastAttempt = Date.now();
        
        if (failedAttempts.count >= 5) {
          failedAttempts.blockUntil = Date.now() + 15 * 60 * 1000; // Блокировка на 15 мин
          showError('Превышено количество попыток. Доступ заблокирован на 15 минут.');
        } else {
          showError(`Неверный пароль. Осталось попыток: ${5 - failedAttempts.count}`);
        }
        return;
      }

      // Сброс счетчика при успешном вводе
      failedAttempts.count = 0;

      const name = document.getElementById('admin-name').value;
      const rfq = document.getElementById('admin-rfq').value;
      const gnezdaInput = document.getElementById('admin-gnezda').value;
      const system = document.getElementById('admin-system').value;
      const dimensionsStr = document.getElementById('admin-dimensions').value;
      const material = document.getElementById('admin-material').value;
      const polzun = document.getElementById('admin-polzun').value === '1';
      const naklon = document.getElementById('admin-naklon').value === '1';
      const vivinch = document.getElementById('admin-vivinch').value === '1';
      const sriv = document.getElementById('admin-sriv').value === '1';
      const vytalk = document.getElementById('admin-vytalk').value;
      const cost = parseFloat(document.getElementById('admin-cost').value.replace(/\s+/g, ''));

      if (!name || !rfq || !gnezdaInput || !system || !dimensionsStr || !material || isNaN(cost)) {
        showError('Заполните все поля!');
        return;
      }

      // Преобразуем габариты
      const dimensions = dimensionsStr.split('x').map(Number);
      if (dimensions.length !== 3 || dimensions.some(isNaN)) {
        showError('Габариты должны быть в формате: 350x450x450');
        return;
      }

      // Преобразуем число гнезд
      let gnezda;
      if (gnezdaInput.includes('×') || gnezdaInput.includes('x') || gnezdaInput.includes('*')) {
        const separator = gnezdaInput.includes('×') ? '×' : 
                         gnezdaInput.includes('x') ? 'x' : '*';
        const parts = gnezdaInput.split(separator);
        if (parts.length !== 2 || isNaN(parseInt(parts[0])) || isNaN(parseInt(parts[1]))) {
          showError('Введите число гнезд в формате: X×Y');
          return;
        }
        gnezda = `${parts[0]}*${parts[1]}`;
      } else {
        showError('Введите число гнезд в формате: X×Y');
        return;
      }

      // Создаем объект пресс-формы
      const newMold = {
        name,
        rfq,
        gnezda,
        system,
        dimensions,
        material,
        polzun,
        naklon,
        vivinch,
        sriv,
        vytalk,
        cost
      };

      moldsDatabase.push(newMold);
      saveDatabase();
      showSuccess('Пресс-форма успешно добавлена в базу!');
      
      // Очистка формы
      document.getElementById('admin-name').value = '';
      document.getElementById('admin-rfq').value = '';
      document.getElementById('admin-gnezda').value = '';
      document.getElementById('admin-dimensions').value = '';
      document.getElementById('admin-cost').value = '';
    }
    
    // Конвертация валют
    function convertCurrency() {
      const amount = parseFloat(document.getElementById('from-amount').value);
      const currency = document.getElementById('from-currency').value;
      
      if (isNaN(amount) || amount <= 0) {
        showError('Введите корректную сумму для конвертации');
        return;
      }
      
      let result, resultText;
      
      if (currency === 'CNY') {
        result = amount * exchangeRate;
        resultText = `${amount.toLocaleString('ru-RU')} CNY = ${result.toLocaleString('ru-RU', {maximumFractionDigits: 2})} RUB`;
      } else {
        result = amount / exchangeRate;
        resultText = `${amount.toLocaleString('ru-RU')} RUB = ${result.toLocaleString('ru-RU', {maximumFractionDigits: 2})} CNY`;
      }
      
      document.getElementById('converter-result').innerHTML = `
        <div style="font-size: 1.8rem; margin-bottom: 10px;">${resultText}</div>
        <div class="converter-rate" id="exchange-rate">Текущий курс: 1 CNY = ${exchangeRate.toFixed(2)} RUB</div>
      `;
    }
    
    // Смена направления конвертации
    function swapCurrencies() {
      const currencySelect = document.getElementById('from-currency');
      currencySelect.value = currencySelect.value === 'CNY' ? 'RUB' : 'CNY';
    }
    
    // Инициализация при загрузке страницы
    window.onload = async function() {
      // Загрузка начальной базы данных
      const initialData = populateInitialDatabase();
      const savedData = localStorage.getItem('moldsDatabase');
      
      if (savedData) {
        const savedMolds = JSON.parse(savedData);
        const uniqueMolds = new Map();
        
        initialData.forEach(mold => {
          const key = `${mold.name}|${mold.rfq}`;
          uniqueMolds.set(key, mold);
        });
        
        savedMolds.forEach(mold => {
          const key = `${mold.name}|${mold.rfq}`;
          uniqueMolds.set(key, mold);
        });
        
        moldsDatabase = Array.from(uniqueMolds.values());
      } else {
        moldsDatabase = initialData;
      }
      
      saveDatabase();
      
      // Загрузка курса валют
      const savedRate = localStorage.getItem('exchangeRate');
      const savedTimestamp = localStorage.getItem('exchangeRateTimestamp');
      
      if (savedRate && savedTimestamp) {
        const age = Date.now() - parseInt(savedTimestamp);
        if (age < 6 * 60 * 60 * 1000) {
          exchangeRate = parseFloat(savedRate);
          updateRateDisplay();
        } else {
          updateExchangeRate();
        }
      } else {
        updateExchangeRate();
      }
      
      // Обновление курса каждый час
      setInterval(updateExchangeRate, 60 * 60 * 1000);
    };
  </script>
</body>
</html>
