<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>КБ-ПРЕССФОРМА | Профессиональный калькулятор</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #0a192f;
      --primary-dark: #020c1b;
      --accent: #d4af37;
      --accent-light: #e6c76a;
      --light: #f8f9fa;
      --dark: #172a45;
      --gray: #8b98b2;
      --border: #31456e;
      --card-bg: rgba(10, 25, 47, 0.95);
      --transition: all 0.3s ease;
      --success: #27ae60;
      --error: #e74c3c;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background: linear-gradient(135deg, var(--primary-dark), var(--primary));
      color: var(--light);
      line-height: 1.6;
      padding: 0;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow-x: hidden;
      font-size: 16px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      flex: 1;
      position: relative;
      z-index: 1;
    }
    
    header {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      padding: 30px 0;
      text-align: center;
      position: relative;
      overflow: hidden;
      z-index: 1;
    }
    
    header::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--accent);
    }
    
    h1 {
      font-size: 2.5rem;
      margin-bottom: 0;
      font-weight: 700;
      letter-spacing: 1px;
      background: linear-gradient(45deg, var(--accent), var(--accent-light));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      position: relative;
      display: inline-block;
      padding: 0 20px;
    }
    
    .tabs {
      display: flex;
      justify-content: center;
      margin: 20px 0 30px;
      gap: 15px;
      flex-wrap: wrap;
    }
    
    .tab-btn {
      background: rgba(23, 42, 69, 0.7);
      color: var(--accent-light);
      border: 1px solid var(--accent);
      padding: 12px 25px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
      min-width: 180px;
      text-align: center;
    }
    
    .tab-btn.active {
      background: var(--accent);
      color: var(--primary-dark);
    }
    
    .tab-btn:hover:not(.active) {
      background: rgba(212, 175, 55, 0.2);
    }
    
    .calculator-container, 
    .admin-panel,
    .converter-container {
      background: var(--card-bg);
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
      overflow: hidden;
      margin: 0 auto 30px;
      max-width: 1000px;
      position: relative;
      z-index: 1;
      border: 1px solid rgba(212, 175, 55, 0.2);
      display: none;
      padding: 25px;
    }
    
    .calculator-container.active,
    .admin-panel.active,
    .converter-container.active {
      display: block;
    }
    
    .calculator {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    
    @media (max-width: 900px) {
      .calculator {
        grid-template-columns: 1fr;
      }
    }
    
    .form-section {
      background: rgba(23, 42, 69, 0.7);
      padding: 25px;
      border-radius: 12px;
      border: 1px solid rgba(212, 175, 55, 0.15);
    }
    
    .section-title {
      font-size: 1.3rem;
      margin-bottom: 20px;
      color: var(--accent-light);
      border-bottom: 2px solid var(--accent);
      padding-bottom: 10px;
      font-weight: 600;
      display: flex;
      align-items: center;
    }
    
    .section-title i {
      margin-right: 12px;
      font-size: 1.1em;
      color: var(--accent);
    }
    
    .form-group {
      margin-bottom: 18px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--accent-light);
      font-size: 1rem;
      display: flex;
      align-items: center;
    }
    
    label i {
      margin-right: 8px;
      font-size: 0.9em;
      color: var(--accent);
    }
    
    input, select {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid rgba(212, 175, 55, 0.25);
      border-radius: 8px;
      font-size: 1rem;
      transition: var(--transition);
      background: rgba(30, 40, 60, 0.6);
      color: white;
    }
    
    input::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }
    
    input:focus, select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.3);
      background: rgba(40, 50, 70, 0.7);
    }
    
    .dimensions-group {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 12px;
    }
    
    .note {
      font-size: 0.85rem;
      color: var(--gray);
      margin-top: 6px;
      font-style: italic;
      padding-left: 26px;
    }
    
    .additional-params {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-top: 10px;
    }
    
    .btn-container {
      grid-column: 1 / -1;
      padding: 10px 0;
    }
    
    .btn-calculate {
      background: linear-gradient(135deg, var(--accent), #b8860b);
      color: white;
      border: none;
      padding: 14px 25px;
      font-size: 1.1rem;
      font-weight: 600;
      border-radius: 10px;
      cursor: pointer;
      transition: var(--transition);
      width: 100%;
      text-transform: uppercase;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .btn-calculate:hover {
      background: linear-gradient(135deg, #e6c76a, #d4af37);
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    .btn-calculate:active {
      transform: translateY(1px);
    }
    
    .btn-calculate i {
      transition: var(--transition);
    }
    
    .result-section {
      grid-column: 1 / -1;
      text-align: center;
      padding: 25px;
      display: none;
      animation: fadeIn 0.5s ease-out;
      background: rgba(23, 42, 69, 0.7);
      border-radius: 12px;
      margin-top: 10px;
      border: 1px solid rgba(212, 175, 55, 0.2);
    }
    
    .result-title {
      font-size: 1.4rem;
      color: var(--accent-light);
      margin-bottom: 20px;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .result-value {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--accent-light);
      margin: 15px 0;
      background: linear-gradient(45deg, var(--accent), var(--accent-light));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .similar-molds {
      margin-top: 25px;
      text-align: left;
    }
    
    .similar-title {
      font-size: 1.2rem;
      color: var(--accent-light);
      margin-bottom: 15px;
      border-bottom: 1px solid var(--accent);
      padding-bottom: 8px;
    }
    
    .mold-list {
      max-height: 300px;
      overflow-y: auto;
      padding-right: 10px;
    }
    
    .mold-item {
      background: rgba(30, 40, 60, 0.6);
      border-left: 3px solid var(--accent);
      padding: 12px 15px;
      margin-bottom: 10px;
      border-radius: 0 6px 6px 0;
      transition: all 0.3s ease;
    }
    
    .mold-item:hover {
      transform: translateX(5px);
      background: rgba(30, 40, 60, 0.8);
    }
    
    .mold-item div {
      margin-bottom: 5px;
      display: flex;
      justify-content: space-between;
    }
    
    .mold-item div:last-child {
      margin-bottom: 0;
    }
    
    .mold-name {
      font-weight: 600;
      color: var(--accent-light);
    }
    
    .mold-value {
      color: var(--gray);
    }
    
    .similarity-badge {
      background: var(--accent);
      color: var(--primary-dark);
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 0.8rem;
      font-weight: bold;
      margin-left: 10px;
    }
    
    footer {
      background: var(--primary-dark);
      color: white;
      padding: 25px 0;
      text-align: center;
      position: relative;
      z-index: 1;
      margin-top: 20px;
      border-top: 1px solid rgba(212, 175, 55, 0.2);
    }
    
    .footer-text {
      font-size: 0.95rem;
      color: var(--gray);
    }
    
    .error-message {
      background: var(--error);
      color: white;
      padding: 12px 40px 12px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: none;
      text-align: center;
      position: relative;
      animation: fadeInDown 0.3s ease-out;
    }

    .error-message.fade-out {
      animation: fadeOutUp 0.3s ease-out forwards;
    }

    .success-message {
      background: var(--success);
      color: white;
      padding: 12px 40px 12px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: none;
      text-align: center;
      position: relative;
      animation: fadeInDown 0.3s ease-out;
    }

    .close-error {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: white;
      font-size: 1.4rem;
      cursor: pointer;
      opacity: 0.8;
      transition: opacity 0.2s;
    }

    .close-error:hover {
      opacity: 1;
    }

    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeOutUp {
      from { opacity: 1; transform: translateY(0); }
      to { opacity: 0; transform: translateY(-20px); }
    }

    /* Конвертер валют */
    .converter {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .converter-section {
      background: rgba(23, 42, 69, 0.7);
      padding: 25px;
      border-radius: 12px;
      border: 1px solid rgba(212, 175, 55, 0.15);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    .converter-title {
      text-align: center;
      margin-bottom: 25px;
      color: var(--accent-light);
      font-size: 1.4rem;
      position: relative;
      padding-bottom: 15px;
    }
    
    .converter-title::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 3px;
      background: var(--accent);
      border-radius: 2px;
    }
    
    .converter-controls {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 15px;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .converter-input-group {
      position: relative;
    }
    
    .converter-input-group label {
      position: absolute;
      top: -20px;
      left: 0;
      font-size: 0.9rem;
      color: var(--accent-light);
    }
    
    .converter-input {
      width: 100%;
      padding: 14px 15px;
      border: 1px solid rgba(212, 175, 55, 0.3);
      border-radius: 8px;
      font-size: 1.1rem;
      background: rgba(30, 40, 60, 0.7);
      color: white;
      transition: var(--transition);
    }
    
    .converter-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2);
    }
    
    .converter-swap {
      background: var(--accent);
      color: var(--primary-dark);
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition);
      font-size: 1.2rem;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
    }
    
    .converter-swap:hover {
      background: var(--accent-light);
      transform: rotate(180deg) scale(1.1);
    }
    
    .converter-result {
      background: rgba(23, 42, 69, 0.9);
      padding: 25px;
      border-radius: 12px;
      text-align: center;
      font-size: 1.4rem;
      font-weight: 600;
      color: var(--accent-light);
      border: 1px solid rgba(212, 175, 55, 0.2);
      min-height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }
    
    .converter-rate {
      font-size: 0.9rem;
      color: var(--gray);
      margin-top: 10px;
      font-style: italic;
    }
    
    /* Анимация фона */
    .mold-animation {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      overflow: hidden;
      opacity: 0.08;
    }
    
    .mold-shape {
      position: absolute;
      animation: float 25s infinite linear;
      filter: drop-shadow(0 0 5px rgba(0,0,0,0.2));
      opacity: 0.7;
      z-index: 0;
      border-radius: 50%;
    }
    
    .mold-1 {
      width: 120px;
      height: 120px;
      background: radial-gradient(circle, var(--accent) 0%, transparent 70%);
      top: 15%;
      left: -50px;
      animation-delay: 0s;
      animation-duration: 35s;
    }
    
    .mold-2 {
      width: 180px;
      height: 180px;
      background: radial-gradient(circle, var(--accent) 0%, transparent 70%);
      top: 65%;
      right: -80px;
      animation-delay: 8s;
      animation-duration: 40s;
    }
    
    .mold-3 {
      width: 150px;
      height: 150px;
      background: radial-gradient(circle, var(--accent-light) 0%, transparent 70%);
      bottom: -70px;
      left: 20%;
      animation-delay: 16s;
      animation-duration: 45s;
    }
    
    .mold-4 {
      width: 100px;
      height: 100px;
      background: radial-gradient(circle, var(--accent-light) 0%, transparent 70%);
      top: 35%;
      right: 15%;
      animation-delay: 24s;
      animation-duration: 30s;
    }
    
    @keyframes float {
      0% {
        transform: translate(0, 0) rotate(0deg);
      }
      25% {
        transform: translate(100px, -150px) rotate(90deg);
      }
      50% {
        transform: translate(200px, 0) rotate(180deg);
      }
      75% {
        transform: translate(100px, 150px) rotate(270deg);
      }
      100% {
        transform: translate(0, 0) rotate(360deg);
      }
    }
    
    /* Адаптивность */
    @media (max-width: 768px) {
      h1 {
        font-size: 2rem;
      }
      
      .calculator, .admin-form {
        grid-template-columns: 1fr;
      }
      
      .tabs {
        flex-direction: column;
        align-items: center;
      }
      
      .tab-btn {
        width: 100%;
        max-width: 300px;
      }
      
      .dimensions-group, .additional-params {
        grid-template-columns: 1fr;
      }
      
      .password-container {
        flex-direction: column;
        align-items: flex-start;
        margin-top: 15px;
      }
      
      #admin-password {
        max-width: 100%;
      }
      
      .result-value {
        font-size: 2rem;
      }
      
      .converter-controls {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto auto;
      }
      
      .converter-swap {
        margin: 15px auto;
        transform: rotate(90deg);
      }
    }
    
    /* Улучшения для админ-панели */
    .password-container {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-top: 20px;
    }
    
    @media (max-width: 768px) {
      .password-container {
        margin-top: 15px;
        gap: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="mold-animation">
    <div class="mold-shape mold-1"></div>
    <div class="mold-shape mold-2"></div>
    <div class="mold-shape mold-3"></div>
    <div class="mold-shape mold-4"></div>
  </div>

  <header>
    <div class="container">
      <h1>КБ-ПРЕССФОРМА</h1>
      
      <div class="tabs">
        <button class="tab-btn active" data-tab="calculator">Калькулятор</button>
        <button class="tab-btn" data-tab="admin">Администрирование</button>
        <button class="tab-btn" data-tab="converter">Конвертер валют</button>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="error-message" id="error-message">
      <button class="close-error" onclick="closeErrorMessage()">&times;</button>
      <span id="error-text"></span>
    </div>
    
    <div class="success-message" id="success-message">
      <button class="close-error" onclick="closeSuccessMessage()">&times;</button>
      <span id="success-text"></span>
    </div>
    
    <!-- Калькулятор -->
    <div class="calculator-container active" id="calculator-container">
      <div class="calculator">
        <div class="form-section">
          <h3 class="section-title"><i class="fas fa-cog"></i> Основные параметры</h3>
          
          <div class="form-group">
            <label for="material"><i class="fas fa-layer-group"></i> Марка стали:</label>
            <select id="material">
              <option value="" disabled selected>Выберите материал</option>
              <option value="738H">738H</option>
              <option value="420">420</option>
              <option value="P20">P20</option>
              <option value="H13">H13</option>
              <option value="S136">S136</option>
              <option value="NAK80">NAK80</option>
              <option value="718H">718H</option>
            </select>
          </div>
          
          <div class="form-group">
            <label><i class="fas fa-ruler-combined"></i> Габариты (мм):</label>
            <div class="dimensions-group">
              <input type="number" id="length" min="50" max="2000" placeholder="Длина">
              <input type="number" id="width" min="50" max="2000" placeholder="Ширина">
              <input type="number" id="height" min="50" max="2000" placeholder="Высота">
            </div>
            <div class="note">Масса рассчитается автоматически</div>
          </div>
          
          <div class="form-group">
            <label for="gnezda"><i class="fas fa-th-large"></i> Число гнёзд (X×Y):</label>
            <input type="text" id="gnezda" placeholder="Например: 1×2">
            <div class="note">Укажите количество по осям X и Y</div>
          </div>
          
          <div class="form-group">
            <label for="system"><i class="fas fa-fire"></i> Тип литниковой системы:</label>
            <select id="system">
              <option value="" disabled selected>Выберите тип</option>
              <option value="Горячий канал">Горячий канал</option>
              <option value="Запорное сопло">Запорное сопло</option>
              <option value="Холодный канал">Холодный канал</option>
              <option value="Трех-плитная">Трех-плитная</option>
            </select>
          </div>
        </div>
        
        <div class="form-section">
          <h3 class="section-title"><i class="fas fa-sliders-h"></i> Дополнительные параметры</h3>
          
          <div class="form-group">
            <label for="polzun"><i class="fas fa-sliders"></i> Ползуны:</label>
            <select id="polzun">
              <option value="0">Нет</option>
              <option value="1">Да</option>
            </select>
          </div>
          
          <div class="additional-params">
            <div class="form-group">
              <label for="naklon"><i class="fas fa-arrows-alt-h"></i> Наклонные толкатели:</label>
              <select id="naklon">
                <option value="0">Нет</option>
                <option value="1">Да</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="vivinch"><i class="fas fa-sync-alt"></i> Вывинчивание:</label>
              <select id="vivinch">
                <option value="0">Нет</option>
                <option value="1">Да</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="sriv"><i class="fas fa-cut"></i> Срывом:</label>
              <select id="sriv">
                <option value="0">Нет</option>
                <option value="1">Да</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="vytalk"><i class="fas fa-eject"></i> Выталкивание:</label>
              <select id="vytalk">
                <option value="Одинарное">Одинарное</option>
                <option value="Двойное">Двойное</option>
              </select>
            </div>
          </div>
        </div>
        
        <div class="btn-container">
          <button class="btn-calculate" onclick="calculate()">
            <i class="fas fa-calculator"></i> РАССЧИТАТЬ СТОИМОСТЬ
          </button>
        </div>
        
        <div class="result-section" id="result">
          <div class="result-title">РАСЧЕТНАЯ СТОИМОСТЬ ПРЕСС-ФОРМЫ</div>
          <div class="result-value" id="result-value">—</div>
          
          <div class="similar-molds">
            <div class="similar-title">Похожие пресс-формы: <span class="note">(отсортированы по схожести)</span></div>
            <div class="mold-list" id="similar-molds">
              <!-- Список похожих пресс-форм будет здесь -->
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Панель администрирования -->
    <div class="admin-panel" id="admin-panel">
      <h3 class="section-title"><i class="fas fa-lock"></i> Редактирование базы данных</h3>
      <p class="note" style="margin-bottom: 20px; padding-left: 0;">Добавленные данные сохраняются даже после перезагрузки страницы</p>
      
      <div class="admin-form">
        <div class="form-group">
          <label for="admin-name">Наименование:</label>
          <input type="text" id="admin-name" placeholder="Например: GS.0219.0001-01">
        </div>
        
        <div class="form-group">
          <label for="admin-rfq">RFQ:</label>
          <input type="text" id="admin-rfq" placeholder="Например: 211">
        </div>
        
        <div class="form-group">
          <label for="admin-gnezda">Число гнёзд (X×Y):</label>
          <input type="text" id="admin-gnezda" placeholder="Например: 1×2">
        </div>
        
        <div class="form-group">
          <label for="admin-system">Тип системы:</label>
          <select id="admin-system">
            <option value="Горячий канал">Горячий канал</option>
            <option value="Запорное сопло">Запорное сопло</option>
            <option value="Холодный канал">Холодный канал</option>
            <option value="Трех-плитная">Трех-плитная</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="admin-dimensions">Габариты (мм):</label>
          <input type="text" id="admin-dimensions" placeholder="Например: 350x450x450">
        </div>
        
        <div class="form-group">
          <label for="admin-material">Марка стали:</label>
          <select id="admin-material">
            <option value="738H">738H</option>
            <option value="420">420</option>
            <option value="P20">P20</option>
            <option value="H13">H13</option>
            <option value="S136">S136</option>
            <option value="NAK80">NAK80</option>
            <option value="718H">718H</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="admin-polzun">Ползуны:</label>
          <select id="admin-polzun">
            <option value="0">Нет</option>
            <option value="1">Да</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="admin-naklon">Наклонные толкатели:</label>
          <select id="admin-naklon">
            <option value="0">Нет</option>
            <option value="1">Да</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="admin-vivinch">Вывинчивание:</label>
          <select id="admin-vivinch">
            <option value="0">Нет</option>
            <option value="1">Да</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="admin-sriv">Срывом:</label>
          <select id="admin-sriv">
            <option value="0">Нет</option>
            <option value="1">Да</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="admin-vytalk">Выталкивание:</label>
          <select id="admin-vytalk">
            <option value="Одинарное">Одинарное</option>
            <option value="Двойное">Двойное</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="admin-cost">Стоимость (руб.):</label>
          <input type="text" id="admin-cost" placeholder="Например: 2611632">
        </div>
        
        <div class="password-container">
          <input type="password" id="admin-password" placeholder="Введите пароль">
          <button class="btn-calculate" onclick="saveToDatabase()">
            <i class="fas fa-save"></i> Сохранить в базу
          </button>
        </div>
      </div>
    </div>
    
    <!-- Конвертер валют -->
    <div class="converter-container" id="converter-container">
      <div class="converter">
        <div class="converter-section">
          <h3 class="converter-title"><i class="fas fa-exchange-alt"></i> Конвертер валют</h3>
          
          <div class="converter-controls">
            <div class="converter-input-group">
              <label for="from-amount">Сумма</label>
              <input type="number" id="from-amount" class="converter-input" placeholder="Введите сумму" min="0" step="0.01">
            </div>
            
            <button class="converter-swap" onclick="swapCurrencies()">
              <i class="fas fa-exchange-alt"></i>
            </button>
            
            <div class="converter-input-group">
              <label for="from-currency">Валюта</label>
              <select id="from-currency" class="converter-input">
                <option value="CNY">Китайский юань (CNY)</option>
                <option value="RUB">Российский рубль (RUB)</option>
              </select>
            </div>
          </div>
          
          <button class="btn-calculate" onclick="convertCurrency()">
            <i class="fas fa-sync-alt"></i> Конвертировать
          </button>
          
          <div class="converter-result" id="converter-result">
            <div>Результат конвертации</div>
            <div class="converter-rate" id="exchange-rate">Загрузка курса...</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <div class="container">
      <p class="footer-text">© 2025 КБ-ПРЕССФОРМА. Профессиональные расчеты стоимости пресс-форм.</p>
    </div>
  </footer>

  <script>
    // Плотность стали (кг/м³) с учетом разных марок
    const DENSITIES = {
      "738H": 7800,
      "420": 7700,
      "P20": 7850,
      "H13": 7800,
      "S136": 7700,
      "NAK80": 7900,
      "718H": 7800
    };
    
    // Базовые стоимости материалов (руб/кг)
    const MATERIAL_COSTS = {
      "738H": 320,
      "420": 280,
      "P20": 350,
      "H13": 420,
      "S136": 580,
      "NAK80": 650,
      "718H": 380
    };
    
    // Коэффициенты сложности
    const COMPLEXITY_FACTORS = {
      "polzun": 1.25,
      "naklon": 1.15,
      "vivinch": 1.30,
      "sriv": 1.20,
      "vytalk_double": 1.18,
      "system_hot": 1.35,
      "system_cold": 1.10,
      "system_nozzle": 1.25,
      "system_three_plate": 1.40
    };
    
    // Пароль для админ-панели
    const ADMIN_PASSWORD = "88168";
    
    // База данных пресс-форм (обновленная)
    let moldsDatabase = [];
    
    // Текущий курс обмена
    let exchangeRate = 11.5; // Значение по умолчанию
    
    // Инициализация базы данных
    function initDatabase() {
      const savedData = localStorage.getItem('moldsDatabase');
      
      if (savedData) {
        moldsDatabase = JSON.parse(savedData);
      } else {
        // Загрузка начальных данных (38 записей)
        moldsDatabase = [
          {
            name: "GS.0219.0001-01",
            rfq: "211",
            gnezda: "1×2",
            system: "Горячий канал",
            dimensions: [350, 450, 450],
            material: "738H",
            polzun: true,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 2611632
          },
          {
            name: "GS.0514.0001",
            rfq: "211",
            gnezda: "1×1",
            system: "Горячий канал",
            dimensions: [400, 650, 620],
            material: "420",
            polzun: true,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 5887757
          },
          {
            name: "GS.0514.0002",
            rfq: "211",
            gnezda: "1×4",
            system: "Холодный канал",
            dimensions: [120, 180, 170],
            material: "420",
            polzun: true,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 869577
          },
          {
            name: "1",
            rfq: "RFQ_196",
            gnezda: "1×1",
            system: "Горячий канал",
            dimensions: [500, 275, 325],
            material: "420",
            polzun: true,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 635000
          },
          {
            name: "1",
            rfq: "RFQ_197",
            gnezda: "1×1",
            system: "Горячий канал",
            dimensions: [450, 450, 720],
            material: "718H",
            polzun: false,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 930000
          },
          {
            name: "GS.0517.0004",
            rfq: "211",
            gnezda: "1×8",
            system: "Горячий канал",
            dimensions: [350, 550, 380],
            material: "420",
            polzun: false,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 3941253
          },
          {
            name: "GS.0517.0004",
            rfq: "211",
            gnezda: "1×4",
            system: "Горячий канал",
            dimensions: [350, 350, 360],
            material: "420",
            polzun: false,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 2160163
          },
          {
            name: "GS.0195.0001",
            rfq: "211",
            gnezda: "1×1",
            system: "Горячий канал",
            dimensions: [250, 500, 420],
            material: "738H",
            polzun: true,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 2745710
          },
          {
            name: "212-14.13.300-01_buton",
            rfq: "198_Tula v21",
            gnezda: "1×2",
            system: "Холодный канал",
            dimensions: [325, 250, 350],
            material: "420",
            polzun: true,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 460000
          },
          {
            name: "1",
            rfq: "210_Tula",
            gnezda: "1×1",
            system: "Холодный канал",
            dimensions: [425, 300, 485],
            material: "420",
            polzun: false,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 600000
          },
          {
            name: "2",
            rfq: "210_Tula",
            gnezda: "1×2",
            system: "Холодный канал",
            dimensions: [325, 300, 350],
            material: "420",
            polzun: false,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 490000
          },
          {
            name: "2",
            rfq: "197",
            gnezda: "1×8",
            system: "Холодный канал",
            dimensions: [450, 450, 720],
            material: "718H",
            polzun: false,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 382000
          },
          {
            name: "1",
            rfq: "193",
            gnezda: "1×4",
            system: "Горячий канал",
            dimensions: [300, 400, 400],
            material: "718H",
            polzun: false,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 590000
          },
          {
            name: "1",
            rfq: "192",
            gnezda: "1×1",
            system: "Горячий канал",
            dimensions: [450, 550, 620],
            material: "H13",
            polzun: true,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 1100000
          },
          {
            name: "1",
            rfq: "188",
            gnezda: "1×16",
            system: "Горячий канал",
            dimensions: [400, 400, 505],
            material: "H13",
            polzun: false,
            naklon: false,
            vivinch: false,
            sriv: true,
            vytalk: "Одинарное",
            cost: 1470000
          },
          {
            name: "1",
            rfq: "182",
            gnezda: "1×8",
            system: "Холодный канал",
            dimensions: [400, 450, 350],
            material: "H13",
            polzun: false,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 820000
          },
          {
            name: "2",
            rfq: "182",
            gnezda: "1×16",
            system: "Холодный канал",
            dimensions: [350, 350, 310],
            material: "H13",
            polzun: false,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 490000
          },
          {
            name: "1",
            rfq: "169",
            gnezda: "1×4",
            system: "Холодный канал",
            dimensions: [225, 225, 325],
            material: "420",
            polzun: false,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 330000
          },
          {
            name: "2",
            rfq: "169",
            gnezda: "1×1",
            system: "Горячий канал",
            dimensions: [1150, 800, 1250],
            material: "420",
            polzun: true,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 6870000
          },
          {
            name: "3",
            rfq: "169",
            gnezda: "1×1",
            system: "Горячий канал",
            dimensions: [1075, 825, 1150],
            material: "420",
            polzun: false,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 6300000
          },
          {
            name: "1",
            rfq: "168",
            gnezda: "1×6",
            system: "Горячий канал",
            dimensions: [500, 600, 500],
            material: "420",
            polzun: false,
            naklon: false,
            vivinch: false,
            sriv: true,
            vytalk: "Двойное",
            cost: 1700000
          },
          {
            name: "2",
            rfq: "168",
            gnezda: "1×8",
            system: "Горячий канал",
            dimensions: [600, 650, 500],
            material: "420",
            polzun: false,
            naklon: false,
            vivinch: false,
            sriv: true,
            vytalk: "Двойное",
            cost: 2150000
          },
          {
            name: "1",
            rfq: "166",
            gnezda: "1×2",
            system: "Холодный канал",
            dimensions: [250, 350, 300],
            material: "P20",
            polzun: false,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 270000
          },
          {
            name: "1",
            rfq: "165",
            gnezda: "1×2",
            system: "Холодный канал",
            dimensions: [250, 300, 300],
            material: "718H",
            polzun: false,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 240000
          },
          {
            name: "1",
            rfq: "164",
            gnezda: "1×2",
            system: "Холодный канал",
            dimensions: [300, 350, 350],
            material: "420",
            polzun: true,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 475000
          },
          {
            name: "1",
            rfq: "161",
            gnezda: "1×2",
            system: "Холодный канал",
            dimensions: [300, 300, 300],
            material: "420",
            polzun: false,
            naklon: false,
            vivinch: false,
            sriv: true,
            vytalk: "Одинарное",
            cost: 380000
          },
          {
            name: "2",
            rfq: "161",
            gnezda: "1×4",
            system: "Холодный канал",
            dimensions: [300, 350, 300],
            material: "420",
            polzun: false,
            naklon: false,
            vivinch: false,
            sriv: true,
            vytalk: "Одинарное",
            cost: 490000
          },
          {
            name: "3",
            rfq: "161",
            gnezda: "1×2",
            system: "Холодный канал",
            dimensions: [300, 300, 300],
            material: "420",
            polzun: true,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 330000
          },
          {
            name: "4",
            rfq: "161",
            gnezda: "1×4",
            system: "Холодный канал",
            dimensions: [300, 350, 300],
            material: "420",
            polzun: true,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 440000
          },
          {
            name: "5",
            rfq: "161",
            gnezda: "1×2",
            system: "Холодный канал",
            dimensions: [350, 400, 320],
            material: "420",
            polzun: false,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 490000
          },
          {
            name: "6",
            rfq: "161",
            gnezda: "1×4",
            system: "Холодный канал",
            dimensions: [400, 450, 330],
            material: "420",
            polzun: false,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 710000
          },
          {
            name: "1",
            rfq: "154",
            gnezda: "1×1",
            system: "Горячий канал",
            dimensions: [300, 300, 350],
            material: "718H",
            polzun: true,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 590000
          },
          {
            name: "1",
            rfq: "152",
            gnezda: "1×2",
            system: "Холодный канал",
            dimensions: [350, 450, 330],
            material: "420",
            polzun: true,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 790000
          },
          {
            name: "1",
            rfq: "151",
            gnezda: "1×4",
            system: "Холодный канал",
            dimensions: [450, 450, 400],
            material: "420",
            polzun: false,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 620000
          },
          {
            name: "1",
            rfq: "144",
            gnezda: "1×1",
            system: "Холодный канал",
            dimensions: [300, 300, 375],
            material: "H13",
            polzun: false,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 710000
          },
          {
            name: "2",
            rfq: "144",
            gnezda: "1×1",
            system: "Холодный канал",
            dimensions: [275, 275, 325],
            material: "H13",
            polzun: false,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 600000
          },
          {
            name: "3",
            rfq: "144",
            gnezda: "1×2",
            system: "Холодный канал",
            dimensions: [300, 250, 325],
            material: "H13",
            polzun: false,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 550000
          },
          {
            name: "1",
            rfq: "141",
            gnezda: "1×1",
            system: "Холодный канал",
            dimensions: [400, 400, 550],
            material: "P20",
            polzun: false,
            naklon: false,
            vivinch: false,
            sriv: false,
            vytalk: "Одинарное",
            cost: 460000
          }
        ];
        saveDatabase();
      }
    }
    
    // Сохранение базы данных в localStorage
    function saveDatabase() {
      localStorage.setItem('moldsDatabase', JSON.stringify(moldsDatabase));
    }
    
    // Обновление курса валют
    async function updateExchangeRate() {
      try {
        const response = await fetch('https://api.exchangerate-api.com/v4/latest/CNY');
        const data = await response.json();
        
        if (data && data.rates && data.rates.RUB) {
          exchangeRate = data.rates.RUB;
          document.getElementById('exchange-rate').textContent = `Текущий курс: 1 CNY = ${exchangeRate.toFixed(2)} RUB`;
          localStorage.setItem('exchangeRate', exchangeRate);
        }
      } catch (error) {
        console.error('Ошибка при получении курса:', error);
        // Используем последнее сохраненное значение
        const savedRate = localStorage.getItem('exchangeRate');
        if (savedRate) {
          exchangeRate = parseFloat(savedRate);
          document.getElementById('exchange-rate').textContent = `Текущий курс: 1 CNY = ${exchangeRate.toFixed(2)} RUB`;
        }
      }
    }

    // Переключение вкладок
    document.querySelectorAll('.tab-btn').forEach(button => {
      button.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        
        document.getElementById('calculator-container').classList.remove('active');
        document.getElementById('admin-panel').classList.remove('active');
        document.getElementById('converter-container').classList.remove('active');
        
        if(button.dataset.tab === 'calculator') {
          document.getElementById('calculator-container').classList.add('active');
        } else if(button.dataset.tab === 'admin') {
          document.getElementById('admin-panel').classList.add('active');
        } else if(button.dataset.tab === 'converter') {
          document.getElementById('converter-container').classList.add('active');
          // При открытии конвертера обновляем курс
          updateExchangeRate();
        }
      });
    });

    // Расчет массы по габаритам с учетом материала
    function calculateMass(material, dimensions) {
      const length = dimensions[0] / 1000; // в метрах
      const width = dimensions[1] / 1000;
      const height = dimensions[2] / 1000;
      
      if (length > 0 && width > 0 && height > 0) {
        const volume = length * width * height;
        const density = DENSITIES[material] || 7850;
        return volume * density;
      }
      return 0;
    }

    function closeErrorMessage() {
      const errorElement = document.getElementById('error-message');
      errorElement.classList.add('fade-out');
      setTimeout(() => {
        errorElement.style.display = 'none';
        errorElement.classList.remove('fade-out');
      }, 300);
    }
    
    function closeSuccessMessage() {
      const successElement = document.getElementById('success-message');
      successElement.classList.add('fade-out');
      setTimeout(() => {
        successElement.style.display = 'none';
        successElement.classList.remove('fade-out');
      }, 300);
    }

    function showError(message) {
      const errorElement = document.getElementById('error-message');
      const errorText = document.getElementById('error-text');
      
      errorText.textContent = message;
      errorElement.style.display = 'block';
      
      setTimeout(closeErrorMessage, 5000);
    }
    
    function showSuccess(message) {
      const successElement = document.getElementById('success-message');
      const successText = document.getElementById('success-text');
      
      successText.textContent = message;
      successElement.style.display = 'block';
      
      setTimeout(closeSuccessMessage, 5000);
    }

    // Улучшенный расчет схожести
    function calculateSimilarity(mold, params) {
      // Веса параметров
      const weights = {
        volume: 0.25,
        nests: 0.2,
        system: 0.15,
        material: 0.15,
        polzun: 0.1,
        naklon: 0.05,
        vivinch: 0.05,
        sriv: 0.05,
        vytalk: 0.05
      };

      // Сравнение объема (относительная разница)
      const moldVolume = mold.dimensions[0] * mold.dimensions[1] * mold.dimensions[2];
      const paramVolume = params.dimensions[0] * params.dimensions[1] * params.dimensions[2];
      const volumeDiff = Math.abs(moldVolume - paramVolume) / Math.max(moldVolume, paramVolume, 1);
      const volumeSimilarity = Math.max(0, 100 - volumeDiff * 50);

      // Сравнение числа гнезд
      let moldNests;
      try {
        if (mold.gnezda.includes('×')) {
          const parts = mold.gnezda.split('×');
          moldNests = parseInt(parts[0]) * parseInt(parts[1]);
        } else if (mold.gnezda.includes('*')) {
          const parts = mold.gnezda.split('*');
          moldNests = parseInt(parts[0]) * parseInt(parts[1]);
        } else if (mold.gnezda.includes('x')) {
          const parts = mold.gnezda.split('x');
          moldNests = parseInt(parts[0]) * parseInt(parts[1]);
        } else {
          moldNests = parseInt(mold.gnezda) || 1;
        }
      } catch (e) {
        moldNests = 1;
      }
      const nestsDiff = Math.abs(moldNests - params.totalNests);
      const nestsSimilarity = Math.max(0, 100 - nestsDiff * 5);

      // Сравнение системы
      const systemMatch = mold.system === params.system ? 100 : 0;

      // Сравнение материала
      const materialMatch = mold.material === params.material ? 100 : 0;

      // Сравнение булевых параметров
      const polzunMatch = mold.polzun === params.polzun ? 100 : 0;
      const naklonMatch = mold.naklon === params.naklon ? 100 : 0;
      const vivinchMatch = mold.vivinch === params.vivinch ? 100 : 0;
      const srivMatch = mold.sriv === params.sriv ? 100 : 0;

      // Сравнение выталкивания
      const vytalkMatch = mold.vytalk === params.vytalk ? 100 : 0;

      // Общая схожесть
      let totalSimilarity = 
        volumeSimilarity * weights.volume +
        nestsSimilarity * weights.nests +
        systemMatch * weights.system +
        materialMatch * weights.material +
        polzunMatch * weights.polzun +
        naklonMatch * weights.naklon +
        vivinchMatch * weights.vivinch +
        srivMatch * weights.sriv +
        vytalkMatch * weights.vytalk;

      return Math.min(100, Math.max(0, Math.round(totalSimilarity)));
    }

    // Поиск похожих пресс-форм
    function findSimilarMolds(params) {
      // Рассчитываем схожесть для каждой пресс-формы в базе
      const moldsWithSimilarity = moldsDatabase.map(mold => {
        const similarity = calculateSimilarity(mold, params);
        return { ...mold, similarity };
      });

      // Сортируем по убыванию схожести
      moldsWithSimilarity.sort((a, b) => b.similarity - a.similarity);

      return moldsWithSimilarity;
    }

    // Расчет стоимости на основе параметров
    function calculateBaseCost(params) {
      // Расчет массы
      const mass = calculateMass(params.material, params.dimensions);
      
      // Базовая стоимость материала
      const materialCost = MATERIAL_COSTS[params.material] || 350;
      let baseCost = mass * materialCost;
      
      // Учет сложности
      if (params.polzun) baseCost *= 1.25;
      if (params.naklon) baseCost *= 1.15;
      if (params.vivinch) baseCost *= 1.30;
      if (params.sriv) baseCost *= 1.20;
      if (params.vytalk === "Двойное") baseCost *= 1.18;
      
      // Учет системы
      if (params.system === "Горячий канал") baseCost *= 1.35;
      else if (params.system === "Запорное сопло") baseCost *= 1.25;
      else if (params.system === "Трех-плитная") baseCost *= 1.40;
      
      // Учет числа гнезд
      baseCost *= (1 + (params.totalNests - 1) * 0.3);
      
      return baseCost;
    }

    function calculate() {
      // Сбор данных
      const material = document.getElementById('material').value;
      const length = parseFloat(document.getElementById('length').value);
      const width = parseFloat(document.getElementById('width').value);
      const height = parseFloat(document.getElementById('height').value);
      const gnezdaInput = document.getElementById('gnezda').value.trim();
      const system = document.getElementById('system').value;
      const polzun = document.getElementById('polzun').value === '1';
      const naklon = document.getElementById('naklon').value === '1';
      const vivinch = document.getElementById('vivinch').value === '1';
      const sriv = document.getElementById('sriv').value === '1';
      const vytalk = document.getElementById('vytalk').value;

      // Проверка заполненности
      if (!material || isNaN(length) || isNaN(width) || isNaN(height) || !gnezdaInput || !system) {
        showError('Заполните все обязательные поля!');
        return;
      }

      // Разбираем число гнезд
      let gnezdaParts;
      if (gnezdaInput.includes('×')) {
        gnezdaParts = gnezdaInput.split('×');
      } else if (gnezdaInput.includes('*')) {
        gnezdaParts = gnezdaInput.split('*');
      } else if (gnezdaInput.includes('x')) {
        gnezdaParts = gnezdaInput.split('x');
      } else {
        showError('Введите число гнезд в формате: X×Y');
        return;
      }

      if (gnezdaParts.length !== 2) {
        showError('Введите число гнезд в формате: X×Y');
        return;
      }

      const x = parseInt(gnezdaParts[0]);
      const y = parseInt(gnezdaParts[1]);
      if (isNaN(x) || isNaN(y)) {
        showError('Введите число гнезд в формате: X×Y');
        return;
      }

      const totalNests = x * y;

      // Параметры для передачи в функции
      const params = {
        material,
        dimensions: [length, width, height],
        gnezda: `${x}×${y}`,
        system,
        polzun,
        naklon,
        vivinch,
        sriv,
        vytalk,
        totalNests
      };

      // Проверка на точное совпадение с существующей пресс-формой
      let exactMatchCost = null;
      for (const mold of moldsDatabase) {
        const sameDimensions = 
          mold.dimensions[0] === length &&
          mold.dimensions[1] === width &&
          mold.dimensions[2] === height;
        
        const sameMaterial = mold.material === material;
        const sameSystem = mold.system === system;
        const samePolzun = mold.polzun === polzun;
        const sameNaklon = mold.naklon === naklon;
        const sameVivinch = mold.vivinch === vivinch;
        const sameSriv = mold.sriv === sriv;
        const sameVytalk = mold.vytalk === vytalk;
        const sameGnezda = mold.gnezda === `${x}×${y}`;
        
        if (sameDimensions && sameMaterial && sameSystem && samePolzun && 
            sameNaklon && sameVivinch && sameSriv && sameVytalk && sameGnezda) {
          exactMatchCost = mold.cost;
          break;
        }
      }

      // Если найдено точное совпадение, используем его стоимость
      if (exactMatchCost !== null) {
        document.getElementById('result-value').textContent = 
          exactMatchCost.toLocaleString('ru-RU') + ' руб.';
        
        document.getElementById('result').style.display = 'block';
        showSuccess('Найдено точное совпадение в базе данных!');
        
        // Показываем похожие пресс-формы
        const similarMolds = findSimilarMolds(params);
        showSimilarMolds(similarMolds);
        return;
      }

      // Найти похожие пресс-формы
      const similarMolds = findSimilarMolds(params);

      // Рассчитать стоимость как среднюю по топ-5 похожим
      let cost = 0;
      if (similarMolds.length > 0) {
        // Берем не более 5
        const topSimilar = similarMolds.slice(0, 5);
        const totalCost = topSimilar.reduce((sum, mold) => sum + mold.cost, 0);
        cost = totalCost / topSimilar.length;
      } else {
        // Если нет похожих, используем базовый расчет
        cost = calculateBaseCost(params);
      }

      // Показать результат
      document.getElementById('result-value').textContent = 
        Math.round(cost).toLocaleString('ru-RU') + ' руб.';
      
      // Показать похожие пресс-формы
      showSimilarMolds(similarMolds);

      // Показать блок с результатом
      document.getElementById('result').style.display = 'block';
    }
    
    // Функция для отображения похожих пресс-форм
    function showSimilarMolds(similarMolds) {
      const similarList = document.getElementById('similar-molds');
      similarList.innerHTML = '';

      // Всегда показываем топ-5 наиболее похожих
      const topMolds = similarMolds.slice(0, 5);
      
      if (topMolds.length > 0) {
        topMolds.forEach(mold => {
          const similarity = mold.similarity;
          const moldEl = document.createElement('div');
          moldEl.className = 'mold-item';
          moldEl.innerHTML = `
            <div><span class="mold-name">${mold.name} (${mold.rfq})</span> <span class="similarity-badge">${similarity}%</span></div>
            <div>Гнёзда: <span class="mold-value">${mold.gnezda}</span></div>
            <div>Система: <span class="mold-value">${mold.system}</span></div>
            <div>Габариты: <span class="mold-value">${mold.dimensions.join('×')} мм</span></div>
            <div>Сталь: <span class="mold-value">${mold.material}</span></div>
            <div>Стоимость: <span class="mold-value">${mold.cost.toLocaleString('ru-RU')} руб.</span></div>
          `;
          similarList.appendChild(moldEl);
        });
      } else {
        similarList.innerHTML = '<div class="mold-item">Нет похожих пресс-форм в базе данных</div>';
      }
    }
    
    // Сохранение в базу данных
    function saveToDatabase() {
      const password = document.getElementById('admin-password').value;
      if (password !== ADMIN_PASSWORD) {
        showError('Неверный пароль!');
        return;
      }

      const name = document.getElementById('admin-name').value;
      const rfq = document.getElementById('admin-rfq').value;
      const gnezda = document.getElementById('admin-gnezda').value;
      const system = document.getElementById('admin-system').value;
      const dimensionsStr = document.getElementById('admin-dimensions').value;
      const material = document.getElementById('admin-material').value;
      const polzun = document.getElementById('admin-polzun').value === '1';
      const naklon = document.getElementById('admin-naklon').value === '1';
      const vivinch = document.getElementById('admin-vivinch').value === '1';
      const sriv = document.getElementById('admin-sriv').value === '1';
      const vytalk = document.getElementById('admin-vytalk').value;
      const cost = parseFloat(document.getElementById('admin-cost').value.replace(/\s+/g, ''));

      if (!name || !rfq || !gnezda || !system || !dimensionsStr || !material || isNaN(cost)) {
        showError('Заполните все поля!');
        return;
      }

      // Преобразуем габариты
      const dimensions = dimensionsStr.split('x').map(Number);
      if (dimensions.length !== 3 || dimensions.some(isNaN)) {
        showError('Габариты должны быть в формате: 350x450x450');
        return;
      }

      // Создаем объект пресс-формы
      const newMold = {
        name,
        rfq,
        gnezda,
        system,
        dimensions,
        material,
        polzun,
        naklon,
        vivinch,
        sriv,
        vytalk,
        cost
      };

      moldsDatabase.push(newMold);
      saveDatabase();
      showSuccess('Пресс-форма успешно добавлена в базу!');
    }
    
    // Конвертация валют
    function convertCurrency() {
      const amount = parseFloat(document.getElementById('from-amount').value);
      const currency = document.getElementById('from-currency').value;
      
      if (isNaN(amount) || amount <= 0) {
        showError('Введите корректную сумму для конвертации');
        return;
      }
      
      let result, resultText;
      
      if (currency === 'CNY') {
        result = amount * exchangeRate;
        resultText = `${amount.toLocaleString('ru-RU')} CNY = ${result.toLocaleString('ru-RU', {maximumFractionDigits: 2})} RUB`;
      } else {
        result = amount / exchangeRate;
        resultText = `${amount.toLocaleString('ru-RU')} RUB = ${result.toLocaleString('ru-RU', {maximumFractionDigits: 2})} CNY`;
      }
      
      document.getElementById('converter-result').innerHTML = `
        <div style="font-size: 1.8rem; margin-bottom: 10px;">${resultText}</div>
        <div class="converter-rate" id="exchange-rate">Текущий курс: 1 CNY = ${exchangeRate.toFixed(2)} RUB</div>
      `;
    }
    
    // Смена направления конвертации
    function swapCurrencies() {
      const currencySelect = document.getElementById('from-currency');
      currencySelect.value = currencySelect.value === 'CNY' ? 'RUB' : 'CNY';
    }
    
    // Инициализация при загрузке страницы
    window.onload = function() {
      initDatabase();
      
      // Загрузка курса валют
      const savedRate = localStorage.getItem('exchangeRate');
      if (savedRate) {
        exchangeRate = parseFloat(savedRate);
        document.getElementById('exchange-rate').textContent = `Текущий курс: 1 CNY = ${exchangeRate.toFixed(2)} RUB`;
      } else {
        updateExchangeRate();
      }
      
      // Автоматическое обновление курса каждые 60 минут
      setInterval(updateExchangeRate, 60 * 60 * 1000);
    };
  </script>
</body>
</html>
