<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Калькулятор стоимости пресс-формы</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    input, select { width: 100%; margin-top: 5px; padding: 8px; margin-bottom: 15px; }
    button { padding: 10px 20px; }
  </style>
</head>
<body>

<h2>Калькулятор стоимости пресс-формы</h2>

<form id="form">
  <label>Материал: <input id="материал" required></label>
  <label>Число гнезд (например 1*2): <input id="гнезда" required></label>
  <label>Тип литниковой системы: <input id="тип" required></label>
  <label>Габариты (мм) — длина: <input type="number" id="длина" required></label>
  <label>Габариты — ширина: <input type="number" id="ширина" required></label>
  <label>Габариты — высота: <input type="number" id="высота" required></label>
  <label>Масса (кг): <input type="number" id="масса" required></label>
  <label>Марка стали: <input id="сталь" required></label>
  <label>Твердость (HRC): <input type="number" id="твердость" required></label>
  <label>Ползуны: 
    <select id="ползун">
      <option value="true">Да</option>
      <option value="false">Нет</option>
    </select>
  </label>
  <button type="submit">Рассчитать</button>
</form>

<h3 id="result"></h3>

<script>
// БАЗА ДАННЫХ ВНУТРИ HTML
const database = [
  {
    наименование: "GS.0219.0001-01",
    материал: "PP",
    гнезда: "1*2",
    тип: "Горячеканальная YUDO",
    габариты: [350, 450, 450],
    масса: 553,
    сталь: "738H",
    твердость: [36, 40],
    ползун: true,
    стоимость: 2611632
  },
  {
    наименование: "GS.0514.0001",
    материал: "POM",
    гнезда: "1*1",
    тип: "Горячеканальная YUDO",
    габариты: [400, 650, 620],
    масса: 1257,
    сталь: "420",
    твердость: [48, 52],
    ползун: true,
    стоимость: 5887757
  },
  {
    наименование: "GS.0514.0002",
    материал: "PP",
    гнезда: "1*8",
    тип: "Холодноканальная",
    габариты: [120, 180, 170],
    масса: 29,
    сталь: "420",
    твердость: [48, 52],
    ползун: false,
    стоимость: 869577
  }
];

function similarityScore(form1, form2) {
  let score = 0;

  if (form1.материал === form2.материал) score += 2;
  if (form1.тип === form2.тип) score += 2;
  if (form1.сталь === form2.сталь) score += 2;
  if (form1.ползун === form2.ползун) score += 1;

  const hardDiff = Math.abs(form1.твердость - ((form2.твердость[0] + form2.твердость[1]) / 2));
  score += Math.max(0, 2 - hardDiff / 5);

  const massDiff = Math.abs(form1.масса - form2.масса);
  score += Math.max(0, 2 - massDiff / 500);

  const dims1 = [form1.длина, form1.ширина, form1.высота];
  const dims2 = form2.габариты;
  const dimDiff = dims1.map((val, i) => Math.abs(val - dims2[i]));
  const avgDimDiff = dimDiff.reduce((a, b) => a + b, 0) / 3;
  score += Math.max(0, 2 - avgDimDiff / 200);

  return score;
}

document.getElementById('form').addEventListener('submit', function (e) {
  e.preventDefault();
  const formData = {
    материал: document.getElementById('материал').value.trim(),
    гнезда: document.getElementById('гнезда').value.trim(),
    тип: document.getElementById('тип').value.trim(),
    длина: +document.getElementById('длина').value,
    ширина: +document.getElementById('ширина').value,
    высота: +document.getElementById('высота').value,
    масса: +document.getElementById('масса').value,
    сталь: document.getElementById('сталь').value.trim(),
    твердость: +document.getElementById('твердость').value,
    ползун: document.getElementById('ползун').value === 'true'
  };

  let bestMatch = null;
  let bestScore = -Infinity;

  for (const item of database) {
    const score = similarityScore(formData, item);
    if (score > bestScore) {
      bestScore = score;
      bestMatch = item;
    }
  }

  if (bestMatch) {
    document.getElementById('result').innerText = 
      `Похожая форма: ${bestMatch.наименование}\nПримерная стоимость: ${bestMatch.стоимость.toLocaleString('ru-RU')} руб.`;
  } else {
    document.getElementById('result').innerText = 'Подходящая форма не найдена.';
  }
});
</script>
</body>
</html>
