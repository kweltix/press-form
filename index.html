<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>КБ-ПРЕССФОРМА | Профессиональный калькулятор</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/charts.css/dist/charts.min.css">
  <style>
    :root {
      --primary: #0a192f;
      --primary-dark: #020c1b;
      --accent: #d4af37;
      --accent-light: #e6c76a;
      --light: #f8f9fa;
      --dark: #172a45;
      --gray: #8b98b2;
      --border: #31456e;
      --card-bg: rgba(10, 25, 47, 0.95);
      --transition: all 0.3s ease;
      --success: #27ae60;
      --error: #e74c3c;
      --warning: #f39c12;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background: linear-gradient(135deg, var(--primary-dark), var(--primary));
      color: var(--light);
      line-height: 1.6;
      padding: 0;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow-x: hidden;
      font-size: 16px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      flex: 1;
      position: relative;
      z-index: 1;
    }
    
    header {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      padding: 30px 0;
      text-align: center;
      position: relative;
      overflow: hidden;
      z-index: 1;
    }
    
    header::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--accent);
    }
    
    h1 {
      font-size: 2.5rem;
      margin-bottom: 0;
      font-weight: 700;
      letter-spacing: 1px;
      background: linear-gradient(45deg, var(--accent), var(--accent-light));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      position: relative;
      display: inline-block;
      padding: 0 20px;
    }
    
    .tabs {
      display: flex;
      justify-content: center;
      margin: 20px 0 30px;
      gap: 15px;
      flex-wrap: wrap;
    }
    
    .tab-btn {
      background: rgba(23, 42, 69, 0.7);
      color: var(--accent-light);
      border: 1px solid var(--accent);
      padding: 12px 25px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
      min-width: 180px;
      text-align: center;
    }
    
    .tab-btn.active {
      background: var(--accent);
      color: var(--primary-dark);
    }
    
    .tab-btn:hover:not(.active) {
      background: rgba(212, 175, 55, 0.2);
    }
    
    .calculator-container, 
    .admin-panel,
    .converter-container {
      background: var(--card-bg);
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
      overflow: hidden;
      margin: 0 auto 30px;
      max-width: 1000px;
      position: relative;
      z-index: 1;
      border: 1px solid rgba(212, 175, 55, 0.2);
      display: none;
      padding: 25px;
    }
    
    .calculator-container.active,
    .admin-panel.active,
    .converter-container.active {
      display: block;
    }
    
    .calculator {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    
    @media (max-width: 900px) {
      .calculator {
        grid-template-columns: 1fr;
      }
    }
    
    .form-section {
      background: rgba(23, 42, 69, 0.7);
      padding: 25px;
      border-radius: 12px;
      border: 1px solid rgba(212, 175, 55, 0.15);
    }
    
    .section-title {
      font-size: 1.3rem;
      margin-bottom: 20px;
      color: var(--accent-light);
      border-bottom: 2px solid var(--accent);
      padding-bottom: 10px;
      font-weight: 600;
      display: flex;
      align-items: center;
    }
    
    .section-title i {
      margin-right: 12px;
      font-size: 1.1em;
      color: var(--accent);
    }
    
    .form-group {
      margin-bottom: 18px;
      position: relative;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--accent-light);
      font-size: 1rem;
      display: flex;
      align-items: center;
    }
    
    label i {
      margin-right: 8px;
      font-size: 0.9em;
      color: var(--accent);
    }
    
    input, select {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid rgba(212, 175, 55, 0.25);
      border-radius: 8px;
      font-size: 1rem;
      transition: var(--transition);
      background: rgba(30, 40, 60, 0.6);
      color: white;
    }
    
    input::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }
    
    input:focus, select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.3);
      background: rgba(40, 50, 70, 0.7);
    }
    
    .dimensions-group {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 12px;
    }
    
    .note {
      font-size: 0.85rem;
      color: var(--gray);
      margin-top: 6px;
      font-style: italic;
      padding-left: 26px;
    }
    
    .additional-params {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-top: 10px;
    }
    
    .btn-container {
      grid-column: 1 / -1;
      padding: 10px 0;
    }
    
    .btn-calculate {
      background: linear-gradient(135deg, var(--accent), #b8860b);
      color: white;
      border: none;
      padding: 14px 25px;
      font-size: 1.1rem;
      font-weight: 600;
      border-radius: 10px;
      cursor: pointer;
      transition: var(--transition);
      width: 100%;
      text-transform: uppercase;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .btn-calculate:hover {
      background: linear-gradient(135deg, #e6c76a, #d4af37);
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    .btn-calculate:active {
      transform: translateY(1px);
    }
    
    .btn-calculate i {
      transition: var(--transition);
    }
    
    .result-section {
      grid-column: 1 / -1;
      text-align: center;
      padding: 25px;
      display: none;
      animation: fadeIn 0.5s ease-out;
      background: rgba(23, 42, 69, 0.7);
      border-radius: 12px;
      margin-top: 10px;
      border: 1px solid rgba(212, 175, 55, 0.2);
    }
    
    .result-title {
      font-size: 1.4rem;
      color: var(--accent-light);
      margin-bottom: 20px;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .result-value {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--accent-light);
      margin: 15px 0;
      background: linear-gradient(45deg, var(--accent), var(--accent-light));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .similar-molds {
      margin-top: 25px;
      text-align: left;
    }
    
    .similar-title {
      font-size: 1.2rem;
      color: var(--accent-light);
      margin-bottom: 15px;
      border-bottom: 1px solid var(--accent);
      padding-bottom: 8px;
    }
    
    .mold-list {
      max-height: 300px;
      overflow-y: auto;
      padding-right: 10px;
    }
    
    .mold-item {
      background: rgba(30, 40, 60, 0.6);
      border-left: 3px solid var(--accent);
      padding: 12px 15px;
      margin-bottom: 10px;
      border-radius: 0 6px 6px 0;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .mold-item:hover {
      transform: translateX(5px);
      background: rgba(30, 40, 60, 0.8);
    }
    
    .mold-item div {
      margin-bottom: 5px;
      display: flex;
      justify-content: space-between;
    }
    
    .mold-item div:last-child {
      margin-bottom: 0;
    }
    
    .mold-name {
      font-weight: 600;
      color: var(--accent-light);
    }
    
    .mold-value {
      color: var(--gray);
    }
    
    .similarity-badge {
      background: var(--accent);
      color: var(--primary-dark);
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 0.8rem;
      font-weight: bold;
      margin-left: 10px;
    }
    
    footer {
      background: var(--primary-dark);
      color: white;
      padding: 25px 0;
      text-align: center;
      position: relative;
      z-index: 1;
      margin-top: 20px;
      border-top: 1px solid rgba(212, 175, 55, 0.2);
    }
    
    .footer-text {
      font-size: 0.95rem;
      color: var(--gray);
    }
    
    .error-message {
      background: var(--error);
      color: white;
      padding: 12px 40px 12px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: none;
      text-align: center;
      position: relative;
      animation: fadeInDown 0.3s ease-out;
    }

    .error-message.fade-out {
      animation: fadeOutUp 0.3s ease-out forwards;
    }

    .success-message {
      background: var(--success);
      color: white;
      padding: 12px 40px 12px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: none;
      text-align: center;
      position: relative;
      animation: fadeInDown 0.3s ease-out;
    }

    .warning-message {
      background: var(--warning);
      color: white;
      padding: 12px 40px 12px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: none;
      text-align: center;
      position: relative;
      animation: fadeInDown 0.3s ease-out;
    }

    .close-error {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: white;
      font-size: 1.4rem;
      cursor: pointer;
      opacity: 0.8;
      transition: opacity 0.2s;
    }

    .close-error:hover {
      opacity: 1;
    }

    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeOutUp {
      from { opacity: 1; transform: translateY(0); }
      to { opacity: 0; transform: translateY(-20px); }
    }

    /* Конвертер валют */
    .converter {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .converter-section {
      background: rgba(23, 42, 69, 0.7);
      padding: 25px;
      border-radius: 12px;
      border: 1px solid rgba(212, 175, 55, 0.15);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    .converter-title {
      text-align: center;
      margin-bottom: 25px;
      color: var(--accent-light);
      font-size: 1.4rem;
      position: relative;
      padding-bottom: 15px;
    }
    
    .converter-title::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 3px;
      background: var(--accent);
      border-radius: 2px;
    }
    
    .converter-controls {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 15px;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .converter-input-group {
      position: relative;
    }
    
    .converter-input-group label {
      position: absolute;
      top: -20px;
      left: 0;
      font-size: 0.9rem;
      color: var(--accent-light);
    }
    
    .converter-input {
      width: 100%;
      padding: 14px 15px;
      border: 1px solid rgba(212, 175, 55, 0.3);
      border-radius: 8px;
      font-size: 1.1rem;
      background: rgba(30, 40, 60, 0.7);
      color: white;
      transition: var(--transition);
    }
    
    .converter-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2);
    }
    
    .converter-swap {
      background: var(--accent);
      color: var(--primary-dark);
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition);
      font-size: 1.2rem;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
    }
    
    .converter-swap:hover {
      background: var(--accent-light);
      transform: rotate(180deg) scale(1.1);
    }
    
    .converter-result {
      background: rgba(23, 42, 69, 0.9);
      padding: 25px;
      border-radius: 12px;
      text-align: center;
      font-size: 1.4rem;
      font-weight: 600;
      color: var(--accent-light);
      border: 1px solid rgba(212, 175, 55, 0.2);
      min-height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }
    
    .converter-rate {
      font-size: 0.9rem;
      color: var(--gray);
      margin-top: 10px;
      font-style: italic;
    }
    
    /* Анимация фона */
    .mold-animation {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      overflow: hidden;
      opacity: 0.08;
    }
    
    .mold-shape {
      position: absolute;
      animation: float 25s infinite linear;
      filter: drop-shadow(0 0 5px rgba(0,0,0,0.2));
      opacity: 0.7;
      z-index: 0;
      border-radius: 50%;
    }
    
    .mold-1 {
      width: 120px;
      height: 120px;
      background: radial-gradient(circle, var(--accent) 0%, transparent 70%);
      top: 15%;
      left: -50px;
      animation-delay: 0s;
      animation-duration: 35s;
    }
    
    .mold-2 {
      width: 180px;
      height: 180px;
      background: radial-gradient(circle, var(--accent) 0%, transparent 70%);
      top: 65%;
      right: -80px;
      animation-delay: 8s;
      animation-duration: 40s;
    }
    
    .mold-3 {
      width: 150px;
      height: 150px;
      background: radial-gradient(circle, var(--accent-light) 0%, transparent 70%);
      bottom: -70px;
      left: 20%;
      animation-delay: 16s;
      animation-duration: 45s;
    }
    
    .mold-4 {
      width: 100px;
      height: 100px;
      background: radial-gradient(circle, var(--accent-light) 0%, transparent 70%);
      top: 35%;
      right: 15%;
      animation-delay: 24s;
      animation-duration: 30s;
    }
    
    @keyframes float {
      0% {
        transform: translate(0, 0) rotate(0deg);
      }
      25% {
        transform: translate(100px, -150px) rotate(90deg);
      }
      50% {
        transform: translate(200px, 0) rotate(180deg);
      }
      75% {
        transform: translate(100px, 150px) rotate(270deg);
      }
      100% {
        transform: translate(0, 0) rotate(360deg);
      }
    }
    
    /* Новые элементы UI */
    .influence-chart {
      margin-top: 20px;
      padding: 15px;
      background: rgba(23, 42, 69, 0.5);
      border-radius: 8px;
    }
    
    .chart-title {
      text-align: center;
      margin-bottom: 15px;
      color: var(--accent-light);
    }
    
    .param-influence {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .param-name {
      width: 150px;
      font-size: 0.9rem;
      color: var(--accent-light);
    }
    
    .param-bar {
      flex-grow: 1;
      height: 15px;
      background: rgba(30, 40, 60, 0.6);
      border-radius: 5px;
      overflow: hidden;
    }
    
    .param-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--accent-light));
      border-radius: 5px;
      transition: width 0.5s ease;
    }
    
    .param-value {
      width: 50px;
      text-align: right;
      font-size: 0.9rem;
      color: var(--accent-light);
    }
    
    .info-icon {
      margin-left: 8px;
      color: var(--accent);
      cursor: pointer;
      font-size: 0.9rem;
    }
    
    .sort-controls {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }
    
    .sort-btn {
      background: rgba(30, 40, 60, 0.6);
      color: var(--accent-light);
      border: 1px solid var(--accent);
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: var(--transition);
    }
    
    .sort-btn.active {
      background: var(--accent);
      color: var(--primary-dark);
    }
    
    .tooltip {
      position: absolute;
      background: rgba(10, 25, 47, 0.95);
      border: 1px solid var(--accent);
      padding: 10px;
      border-radius: 5px;
      z-index: 100;
      max-width: 300px;
      display: none;
      font-size: 0.9rem;
      color: var(--light);
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    
    .complexity-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-left: 5px;
    }
    
    .complexity-low { background: #27ae60; }
    .complexity-medium { background: #f39c12; }
    .complexity-high { background: #e74c3c; }

    /* Адаптивность */
    @media (max-width: 768px) {
      h1 {
        font-size: 2rem;
      }
      
      .calculator, .admin-form {
        grid-template-columns: 1fr;
      }
      
      .tabs {
        flex-direction: column;
        align-items: center;
      }
      
      .tab-btn {
        width: 100%;
        max-width: 300px;
      }
      
      .dimensions-group, .additional-params {
        grid-template-columns: 1fr;
      }
      
      .password-container {
        flex-direction: column;
        align-items: flex-start;
        margin-top: 15px;
      }
      
      #admin-password {
        max-width: 100%;
      }
      
      .result-value {
        font-size: 2rem;
      }
      
      .converter-controls {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto auto;
      }
      
      .converter-swap {
        margin: 15px auto;
        transform: rotate(90deg);
      }
      
      .param-name {
        width: 120px;
      }
    }
  </style>
</head>
<body>
  <div class="mold-animation">
    <div class="mold-shape mold-1"></div>
    <div class="mold-shape mold-2"></div>
    <div class="mold-shape mold-3"></div>
    <div class="mold-shape mold-4"></div>
  </div>

  <header>
    <div class="container">
      <h1>КБ-ПРЕССФОРМА</h1>
      
      <div class="tabs">
        <button class="tab-btn active" data-tab="calculator">Калькулятор</button>
        <button class="tab-btn" data-tab="admin">Администрирование</button>
        <button class="tab-btn" data-tab="converter">Конвертер валют</button>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="error-message" id="error-message">
      <button class="close-error" onclick="closeErrorMessage()">&times;</button>
      <span id="error-text"></span>
    </div>
    
    <div class="success-message" id="success-message">
      <button class="close-error" onclick="closeSuccessMessage()">&times;</button>
      <span id="success-text"></span>
    </div>
    
    <div class="warning-message" id="warning-message">
      <button class="close-error" onclick="closeWarningMessage()">&times;</button>
      <span id="warning-text"></span>
    </div>
    
    <!-- Калькулятор -->
    <div class="calculator-container active" id="calculator-container">
      <div class="calculator">
        <div class="form-section">
          <h3 class="section-title"><i class="fas fa-cog"></i> Основные параметры</h3>
          
          <div class="form-group">
            <label for="material"><i class="fas fa-layer-group"></i> Марка стали:</label>
            <select id="material">
              <option value="" disabled selected>Выберите материал</option>
              <option value="738H">738H</option>
              <option value="420">420</option>
              <option value="P20">P20</option>
              <option value="H13">H13</option>
              <option value="S136">S136</option>
              <option value="NAK80">NAK80</option>
              <option value="718H">718H</option>
            </select>
          </div>
          
          <div class="form-group">
            <label><i class="fas fa-ruler-combined"></i> Габариты (мм):</label>
            <div class="dimensions-group">
              <input type="number" id="length" min="50" max="2000" placeholder="Длина">
              <input type="number" id="width" min="50" max="2000" placeholder="Ширина">
              <input type="number" id="height" min="50" max="2000" placeholder="Высота">
            </div>
            <div class="note">Масса рассчитается автоматически</div>
          </div>
          
          <div class="form-group">
            <label for="gnezda"><i class="fas fa-th-large"></i> Число гнёзд (X×Y):</label>
            <input type="text" id="gnezda" placeholder="Например: 1×2">
            <div class="note">Укажите количество по осям X и Y</div>
          </div>
          
          <div class="form-group">
            <label for="system"><i class="fas fa-fire"></i> Тип литниковой системы:</label>
            <select id="system">
              <option value="" disabled selected>Выберите тип</option>
              <option value="Горячий канал">Горячий канал</option>
              <option value="Запорное сопло">Запорное сопло</option>
              <option value="Холодный канал">Холодный канал</option>
              <option value="Трех-плитная">Трех-плитная</option>
            </select>
          </div>
        </div>
        
        <div class="form-section">
          <h3 class="section-title"><i class="fas fa-sliders-h"></i> Дополнительные параметры</h3>
          
          <div class="form-group">
            <label for="polzun"><i class="fas fa-sliders"></i> Ползуны:</label>
            <select id="polzun">
              <option value="0">Нет</option>
              <option value="1">Да</option>
            </select>
          </div>
          
          <div class="additional-params">
            <div class="form-group">
              <label for="naklon"><i class="fas fa-arrows-alt-h"></i> Наклонные толкатели:</label>
              <select id="naklon">
                <option value="0">Нет</option>
                <option value="1">Да</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="vivinch"><i class="fas fa-sync-alt"></i> Вывинчивание:</label>
              <select id="vivinch">
                <option value="0">Нет</option>
                <option value="1">Да</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="sriv"><i class="fas fa-cut"></i> Срывом:</label>
              <select id="sriv">
                <option value="0">Нет</option>
                <option value="1">Да</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="vytalk"><i class="fas fa-eject"></i> Выталкивание:</label>
              <select id="vytalk">
                <option value="Одинарное">Одинарное</option>
                <option value="Двойное">Двойное</option>
              </select>
            </div>
          </div>
        </div>
        
        <div class="btn-container">
          <button class="btn-calculate" onclick="calculate()">
            <i class="fas fa-calculator"></i> РАССЧИТАТЬ СТОИМОСТЬ
          </button>
        </div>
        
        <div class="result-section" id="result">
          <div class="result-title">РАСЧЕТНАЯ СТОИМОСТЬ ПРЕСС-ФОРМЫ</div>
          <div class="result-value" id="result-value">—</div>
          
          <div class="influence-chart">
            <div class="chart-title">Влияние параметров на стоимость</div>
            <div id="influence-container"></div>
          </div>
          
          <div class="similar-molds">
            <div class="similar-title">
              Похожие пресс-формы: 
              <span class="note">(отсортированы по схожести)</span>
              <div class="sort-controls">
                <button class="sort-btn active" data-sort="similarity">По схожести</button>
                <button class="sort-btn" data-sort="price-asc">Цена ↑</button>
                <button class="sort-btn" data-sort="price-desc">Цена ↓</button>
                <button class="sort-btn" data-sort="date">По дате</button>
              </div>
            </div>
            <div class="mold-list" id="similar-molds">
              <!-- Список похожих пресс-форм будет здесь -->
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Панель администрирования -->
    <div class="admin-panel" id="admin-panel">
      <h3 class="section-title"><i class="fas fa-lock"></i> Редактирование базы данных</h3>
      <p class="note" style="margin-bottom: 20px; padding-left: 0;">Добавленные данные сохраняются даже после перезагрузки страницы</p>
      
      <div class="admin-form">
        <div class="form-group">
          <label for="admin-name">Наименование:</label>
          <input type="text" id="admin-name" placeholder="Например: GS.0219.0001-01">
        </div>
        
        <div class="form-group">
          <label for="admin-rfq">RFQ:</label>
          <input type="text" id="admin-rfq" placeholder="Например: 211">
        </div>
        
        <div class="form-group">
          <label for="admin-gnezda">Число гнёзд (X×Y):</label>
          <input type="text" id="admin-gnezda" placeholder="Например: 1×2">
        </div>
        
        <div class="form-group">
          <label for="admin-system">Тип системы:</label>
          <select id="admin-system">
            <option value="Горячий канал">Горячий канал</option>
            <option value="Запорное сопло">Запорное сопло</option>
            <option value="Холодный канал">Холодный канал</option>
            <option value="Трех-плитная">Трех-плитная</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="admin-dimensions">Габариты (мм):</label>
          <input type="text" id="admin-dimensions" placeholder="Например: 350x450x450">
        </div>
        
        <div class="form-group">
          <label for="admin-material">Марка стали:</label>
          <select id="admin-material">
            <option value="738H">738H</option>
            <option value="420">420</option>
            <option value="P20">P20</option>
            <option value="H13">H13</option>
            <option value="S136">S136</option>
            <option value="NAK80">NAK80</option>
            <option value="718H">718H</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="admin-polzun">Ползуны:</label>
          <select id="admin-polzun">
            <option value="0">Нет</option>
            <option value="1">Да</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="admin-naklon">Наклонные толкатели:</label>
          <select id="admin-naklon">
            <option value="0">Нет</option>
            <option value="1">Да</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="admin-vivinch">Вывинчивание:</label>
          <select id="admin-vivinch">
            <option value="0">Нет</option>
            <option value="1">Да</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="admin-sriv">Срывом:</label>
          <select id="admin-sriv">
            <option value="0">Нет</option>
            <option value="1">Да</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="admin-vytalk">Выталкивание:</label>
          <select id="admin-vytalk">
            <option value="Одинарное">Одинарное</option>
            <option value="Двойное">Двойное</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="admin-cost">Стоимость (руб.):</label>
          <input type="text" id="admin-cost" placeholder="Например: 2611632">
        </div>
        
        <div class="form-group">
          <label for="admin-date">Дата создания:</label>
          <input type="date" id="admin-date">
        </div>
        
        <div class="password-container">
          <input type="password" id="admin-password" placeholder="Введите пароль">
          <button class="btn-calculate" onclick="saveToDatabase()">
            <i class="fas fa-save"></i> Сохранить в базу
          </button>
        </div>
      </div>
    </div>
    
    <!-- Конвертер валют -->
    <div class="converter-container" id="converter-container">
      <div class="converter">
        <div class="converter-section">
          <h3 class="converter-title"><i class="fas fa-exchange-alt"></i> Конвертер валют</h3>
          
          <div class="converter-controls">
            <div class="converter-input-group">
              <label for="from-amount">Сумма</label>
              <input type="number" id="from-amount" class="converter-input" placeholder="Введите сумму" min="0" step="0.01">
            </div>
            
            <button class="converter-swap" onclick="swapCurrencies()">
              <i class="fas fa-exchange-alt"></i>
            </button>
            
            <div class="converter-input-group">
              <label for="from-currency">Валюта</label>
              <select id="from-currency" class="converter-input">
                <option value="CNY">Китайский юань (CNY)</option>
                <option value="RUB">Российский рубль (RUB)</option>
              </select>
            </div>
          </div>
          
          <button class="btn-calculate" onclick="convertCurrency()">
            <i class="fas fa-sync-alt"></i> Конвертировать
          </button>
          
          <div class="converter-result" id="converter-result">
            <div>Результат конвертации</div>
            <div class="converter-rate" id="exchange-rate">Загрузка курса...</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <div class="container">
      <p class="footer-text">© 2025 КБ-ПРЕССФОРМА. Профессиональные расчеты стоимости пресс-форм.</p>
    </div>
  </footer>

  <div class="tooltip" id="tooltip"></div>

  <script>
    // Плотность стали (кг/м³) с учетом разных марок
    const DENSITIES = {
      "738H": 7800,
      "420": 7700,
      "P20": 7850,
      "H13": 7800,
      "S136": 7700,
      "NAK80": 7900,
      "718H": 7800
    };
    
    // Базовые стоимости материалов (руб/кг)
    const MATERIAL_COSTS = {
      "738H": 320,
      "420": 280,
      "P20": 350,
      "H13": 420,
      "S136": 580,
      "NAK80": 650,
      "718H": 380
    };
    
    // Коэффициенты сложности
    const COMPLEXITY_FACTORS = {
      "polzun": 1.25,
      "naklon": 1.15,
      "vivinch": 1.30,
      "sriv": 1.20,
      "vytalk_double": 1.18,
      "system_hot": 1.35,
      "system_cold": 1.10,
      "system_nozzle": 1.25,
      "system_three_plate": 1.40
    };
    
    // Пароль для админ-панели
    const ADMIN_PASSWORD = "88168";
    
    // База данных пресс-форм
    let moldsDatabase = [];
    
    // Текущий курс обмена
    let exchangeRate = 11.5;
    
    // Инициализация базы данных
    function initDatabase() {
      const savedData = localStorage.getItem('moldsDatabase');
      
      if (savedData) {
        moldsDatabase = JSON.parse(savedData);
      } else {
        // Загрузка начальных данных
        moldsDatabase = [
          // ... (ваша база данных) ...
        ];
        saveDatabase();
      }
    }
    
    // Сохранение базы данных
    function saveDatabase() {
      localStorage.setItem('moldsDatabase', JSON.stringify(moldsDatabase));
    }
    
    // Обновление курса валют
    async function updateExchangeRate() {
      try {
        const response = await fetch('https://api.exchangerate-api.com/v4/latest/CNY');
        const data = await response.json();
        
        if (data?.rates?.RUB) {
          exchangeRate = data.rates.RUB;
          document.getElementById('exchange-rate').textContent = `Текущий курс: 1 CNY = ${exchangeRate.toFixed(2)} RUB`;
          localStorage.setItem('exchangeRate', exchangeRate);
        }
      } catch (error) {
        console.error('Ошибка при получении курса:', error);
        const savedRate = localStorage.getItem('exchangeRate');
        if (savedRate) {
          exchangeRate = parseFloat(savedRate);
          document.getElementById('exchange-rate').textContent = `Текущий курс: 1 CNY = ${exchangeRate.toFixed(2)} RUB`;
        }
      }
    }

    // Переключение вкладок
    document.querySelectorAll('.tab-btn').forEach(button => {
      button.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        
        document.getElementById('calculator-container').classList.remove('active');
        document.getElementById('admin-panel').classList.remove('active');
        document.getElementById('converter-container').classList.remove('active');
        
        if(button.dataset.tab === 'calculator') {
          document.getElementById('calculator-container').classList.add('active');
        } else if(button.dataset.tab === 'admin') {
          document.getElementById('admin-panel').classList.add('active');
        } else if(button.dataset.tab === 'converter') {
          document.getElementById('converter-container').classList.add('active');
          updateExchangeRate();
        }
      });
    });

    // Расчет массы
    function calculateMass(material, dimensions) {
      const [l, w, h] = dimensions.map(d => d / 1000);
      if (l > 0 && w > 0 && h > 0) {
        return l * w * h * (DENSITIES[material] || 7850);
      }
      return 0;
    }

    // Управление сообщениями
    function closeErrorMessage() {
      hideMessage('error-message');
    }
    
    function closeSuccessMessage() {
      hideMessage('success-message');
    }
    
    function closeWarningMessage() {
      hideMessage('warning-message');
    }
    
    function hideMessage(elementId) {
      const element = document.getElementById(elementId);
      element.classList.add('fade-out');
      setTimeout(() => {
        element.style.display = 'none';
        element.classList.remove('fade-out');
      }, 300);
    }

    function showError(message) {
      showMessage('error-message', 'error-text', message);
    }
    
    function showSuccess(message) {
      showMessage('success-message', 'success-text', message);
    }
    
    function showWarning(message) {
      showMessage('warning-message', 'warning-text', message);
    }
    
    function showMessage(containerId, textId, message) {
      const container = document.getElementById(containerId);
      const textElement = document.getElementById(textId);
      
      textElement.textContent = message;
      container.style.display = 'block';
      
      setTimeout(() => hideMessage(containerId), 5000);
    }

    // Улучшенный расчет схожести
    function calculateSimilarity(mold, params) {
      // Веса параметров (динамические)
      const weights = {
        volume: 0.25,
        nests: 0.20,
        system: 0.15,
        material: 0.10,
        polzun: 0.06,
        naklon: 0.05,
        vivinch: 0.05,
        sriv: 0.04,
        vytalk: 0.04,
        mass: 0.03,
        complexity: 0.03
      };

      // 1. Сравнение объема (логарифмическая шкала)
      const moldVolume = Math.log1p(mold.dimensions[0] * mold.dimensions[1] * mold.dimensions[2]);
      const paramVolume = Math.log1p(params.dimensions[0] * params.dimensions[1] * params.dimensions[2]);
      const volumeDiff = Math.abs(moldVolume - paramVolume);
      const volumeSimilarity = Math.max(0, 100 - volumeDiff * 20);

      // 2. Сравнение числа гнезд
      const moldNests = parseNests(mold.gnezda);
      const paramNests = parseNests(params.gnezda);
      const nestsDiff = Math.abs(moldNests - paramNests);
      const nestsSimilarity = Math.max(0, 100 - nestsDiff * 5);

      // 3. Сравнение системы
      const systemMatch = mold.system === params.system ? 100 : 50;

      // 4. Сравнение материала
      const materialMatch = mold.material === params.material ? 100 : 70;

      // 5. Сравнение булевых параметров
      const polzunMatch = mold.polzun === params.polzun ? 100 : 80;
      const naklonMatch = mold.naklon === params.naklon ? 100 : 85;
      const vivinchMatch = mold.vivinch === params.vivinch ? 100 : 75;
      const srivMatch = mold.sriv === params.sriv ? 100 : 90;

      // 6. Сравнение выталкивания
      const vytalkMatch = mold.vytalk === params.vytalk ? 100 : 60;
      
      // 7. Сравнение массы
      const moldMass = calculateMass(mold.material, mold.dimensions);
      const paramMass = calculateMass(params.material, params.dimensions);
      const massDiff = Math.abs(moldMass - paramMass) / Math.max(moldMass, paramMass, 1);
      const massSimilarity = (1 - massDiff) * 100;
      
      // 8. Сравнение сложности
      const moldComplexity = calculateComplexity(mold);
      const paramComplexity = calculateComplexity(params);
      const complexityDiff = Math.abs(moldComplexity - paramComplexity);
      const complexitySimilarity = Math.max(0, 100 - complexityDiff * 10);

      // Общая схожесть
      return (
        volumeSimilarity * weights.volume +
        nestsSimilarity * weights.nests +
        systemMatch * weights.system +
        materialMatch * weights.material +
        polzunMatch * weights.polzun +
        naklonMatch * weights.naklon +
        vivinchMatch * weights.vivinch +
        srivMatch * weights.sriv +
        vytalkMatch * weights.vytalk +
        massSimilarity * weights.mass +
        complexitySimilarity * weights.complexity
      );
    }
    
    // Расчет сложности пресс-формы
    function calculateComplexity(mold) {
      let complexity = 1.0;
      
      // Базовые факторы
      if (mold.polzun) complexity *= COMPLEXITY_FACTORS.polzun;
      if (mold.naklon) complexity *= COMPLEXITY_FACTORS.naklon;
      if (mold.vivinch) complexity *= COMPLEXITY_FACTORS.vivinch;
      if (mold.sriv) complexity *= COMPLEXITY_FACTORS.sriv;
      if (mold.vytalk === "Двойное") complexity *= COMPLEXITY_FACTORS.vytalk_double;
      
      // Система
      if (mold.system === "Горячий канал") complexity *= COMPLEXITY_FACTORS.system_hot;
      else if (mold.system === "Холодный канал") complexity *= COMPLEXITY_FACTORS.system_cold;
      else if (mold.system === "Запорное сопло") complexity *= COMPLEXITY_FACTORS.system_nozzle;
      else if (mold.system === "Трех-плитная") complexity *= COMPLEXITY_FACTORS.system_three_plate;
      
      // Размерный фактор
      const sizeFactor = Math.log1p(mold.dimensions[0] + mold.dimensions[1] + mold.dimensions[2]) / 10;
      complexity *= (1 + sizeFactor);
      
      return complexity;
    }
    
    // Парсинг числа гнезд
    function parseNests(gnezdaStr) {
      if (!gnezdaStr) return 0;
      
      const separator = gnezdaStr.includes('×') ? '×' : 
                       gnezdaStr.includes('x') ? 'x' : 
                       gnezdaStr.includes('*') ? '*' : null;
      
      if (!separator) return parseInt(gnezdaStr) || 0;
      
      const parts = gnezdaStr.split(separator);
      if (parts.length !== 2) return parseInt(gnezdaStr) || 0;
      
      const x = parseInt(parts[0]) || 0;
      const y = parseInt(parts[1]) || 0;
      
      return x * y;
    }

    // Поиск похожих пресс-форм
    function findSimilarMolds(params, sortBy = 'similarity') {
      const moldsWithSimilarity = moldsDatabase.map(mold => {
        const similarity = calculateSimilarity(mold, params);
        return { ...mold, similarity, date: mold.date || new Date().toISOString() };
      });
      
      // Сортировка
      switch(sortBy) {
        case 'price-asc':
          moldsWithSimilarity.sort((a, b) => a.cost - b.cost);
          break;
        case 'price-desc':
          moldsWithSimilarity.sort((a, b) => b.cost - a.cost);
          break;
        case 'date':
          moldsWithSimilarity.sort((a, b) => new Date(b.date) - new Date(a.date));
          break;
        default: // similarity
          moldsWithSimilarity.sort((a, b) => b.similarity - a.similarity);
      }
      
      return moldsWithSimilarity;
    }
    
    // Расчет базовой стоимости
    function calculateBaseCost(params) {
      // Расчет массы
      const mass = calculateMass(params.material, params.dimensions);
      
      // Базовая стоимость материала
      const materialCost = MATERIAL_COSTS[params.material] || 350;
      let baseCost = mass * materialCost;
      
      // Учет сложности
      const complexity = calculateComplexity(params);
      baseCost *= complexity;
      
      // Учет числа гнезд
      const nestsFactor = 1 + (params.totalNests - 1) * 0.3;
      baseCost *= nestsFactor;
      
      // Инфляционная корректировка (5% в год)
      const currentYear = new Date().getFullYear();
      const inflation = Math.pow(1.05, currentYear - 2023);
      baseCost *= inflation;
      
      return baseCost;
    }

    // Расчет стоимости на основе похожих пресс-форм
    function calculateCostFromSimilar(params, similarMolds) {
      if (similarMolds.length === 0) return 0;
      
      // Фильтруем только релевантные (>60% схожести)
      const relevantMolds = similarMolds.filter(m => m.similarity > 60);
      
      if (relevantMolds.length === 0) {
        // Если нет достаточно похожих, используем базовый расчет
        return calculateBaseCost(params);
      }
      
      // Средневзвешенная стоимость по схожести
      let totalCost = 0;
      let totalWeight = 0;
      
      relevantMolds.slice(0, 5).forEach(mold => {
        const weight = Math.pow(mold.similarity / 100, 2);
        totalCost += mold.cost * weight;
        totalWeight += weight;
      });
      
      return totalWeight > 0 ? totalCost / totalWeight : 0;
    }
    
    // Отображение влияния параметров
    function showParameterInfluence(params, cost) {
      const container = document.getElementById('influence-container');
      container.innerHTML = '';
      
      const baseCost = calculateBaseCost({...params, polzun: false, naklon: false, vivinch: false, sriv: false, vytalk: "Одинарное"});
      
      const factors = [
        { name: "Материал", value: MATERIAL_COSTS[params.material] || 350, base: 350 },
        { name: "Габариты", value: params.dimensions.reduce((a, b) => a + b, 0) / 1000, base: 0.5 },
        { name: "Число гнёзд", value: params.totalNests, base: 1 },
        { name: "Система", value: params.system, type: 'text' },
        { name: "Ползуны", value: params.polzun, type: 'bool' },
        { name: "Толкатели", value: params.naklon, type: 'bool' },
        { name: "Вывинчивание", value: params.vivinch, type: 'bool' },
        { name: "Срыв", value: params.sriv, type: 'bool' },
        { name: "Выталкивание", value: params.vytalk === "Двойное" ? 1 : 0, type: 'bool' }
      ];
      
      factors.forEach(factor => {
        const factorEl = document.createElement('div');
        factorEl.className = 'param-influence';
        
        const nameEl = document.createElement('div');
        nameEl.className = 'param-name';
        nameEl.textContent = factor.name;
        
        const barEl = document.createElement('div');
        barEl.className = 'param-bar';
        
        const fillEl = document.createElement('div');
        fillEl.className = 'param-fill';
        
        const valueEl = document.createElement('div');
        valueEl.className = 'param-value';
        
        // Расчет влияния
        let influence = 0;
        if (factor.type === 'bool') {
          influence = factor.value ? 15 : 0;
        } else if (factor.type === 'text') {
          influence = 20; // для систем
        } else {
          influence = Math.min(50, (factor.value - factor.base) / factor.base * 100);
        }
        
        fillEl.style.width = `${Math.min(100, Math.max(5, influence))}%`;
        valueEl.textContent = `${influence.toFixed(1)}%`;
        
        barEl.appendChild(fillEl);
        factorEl.appendChild(nameEl);
        factorEl.appendChild(barEl);
        factorEl.appendChild(valueEl);
        
        container.appendChild(factorEl);
      });
    }

    // Основная функция расчета
    function calculate() {
      // Сбор данных
      const material = document.getElementById('material').value;
      const length = parseFloat(document.getElementById('length').value);
      const width = parseFloat(document.getElementById('width').value);
      const height = parseFloat(document.getElementById('height').value);
      const gnezdaInput = document.getElementById('gnezda').value.trim();
      const system = document.getElementById('system').value;
      const polzun = document.getElementById('polzun').value === '1';
      const naklon = document.getElementById('naklon').value === '1';
      const vivinch = document.getElementById('vivinch').value === '1';
      const sriv = document.getElementById('sriv').value === '1';
      const vytalk = document.getElementById('vytalk').value;

      // Проверка заполненности
      if (!material || isNaN(length) || isNaN(width) || isNaN(height) || !gnezdaInput || !system) {
        showError('Заполните все обязательные поля!');
        return;
      }

      // Разбор числа гнезд
      const totalNests = parseNests(gnezdaInput);
      if (totalNests <= 0) {
        showError('Неверный формат числа гнезд. Используйте X×Y');
        return;
      }

      // Параметры для расчета
      const params = {
        material,
        dimensions: [length, width, height],
        gnezda: gnezdaInput,
        system,
        polzun,
        naklon,
        vivinch,
        sriv,
        vytalk,
        totalNests
      };

      // Поиск похожих пресс-форм
      const sortBy = document.querySelector('.sort-btn.active')?.dataset.sort || 'similarity';
      const similarMolds = findSimilarMolds(params, sortBy);

      // Расчет стоимости
      let cost = calculateCostFromSimilar(params, similarMolds);
      
      // Если не удалось рассчитать
      if (cost <= 0) {
        cost = calculateBaseCost(params);
        showWarning('Стоимость рассчитана приблизительно на основе параметров');
      }

      // Показать результат
      document.getElementById('result-value').textContent = 
        cost > 0 ? Math.round(cost).toLocaleString('ru-RU') + ' руб.' : 'Недостаточно данных';

      // Показать влияние параметров
      showParameterInfluence(params, cost);

      // Показать похожие пресс-формы
      const similarList = document.getElementById('similar-molds');
      similarList.innerHTML = '';

      if (similarMolds.length > 0) {
        similarMolds.slice(0, 5).forEach(mold => {
          const similarity = mold.similarity;
          const complexity = calculateComplexity(mold);
          
          let complexityClass = 'complexity-low';
          if (complexity > 1.5) complexityClass = 'complexity-high';
          else if (complexity > 1.2) complexityClass = 'complexity-medium';
          
          const moldEl = document.createElement('div');
          moldEl.className = 'mold-item';
          moldEl.innerHTML = `
            <div>
              <span class="mold-name">${mold.name} (${mold.rfq})</span> 
              <span class="similarity-badge">${Math.round(similarity)}%</span>
              <span class="complexity-indicator ${complexityClass}" title="Сложность: ${complexity.toFixed(2)}"></span>
            </div>
            <div>Гнёзда: <span class="mold-value">${mold.gnezda}</span></div>
            <div>Система: <span class="mold-value">${mold.system}</span></div>
            <div>Габариты: <span class="mold-value">${mold.dimensions.join('×')} мм</span></div>
            <div>Сталь: <span class="mold-value">${mold.material}</span></div>
            <div>Стоимость: <span class="mold-value">${mold.cost.toLocaleString('ru-RU')} руб.</span></div>
            ${mold.date ? `<div>Дата: <span class="mold-value">${new Date(mold.date).toLocaleDateString()}</span></div>` : ''}
          `;
          
          // Клик по элементу заполняет форму
          moldEl.addEventListener('click', () => {
            fillFormWithMoldData(mold);
          });
          
          similarList.appendChild(moldEl);
        });
      } else {
        similarList.innerHTML = '<div class="mold-item">Нет похожих пресс-форм в базе данных</div>';
      }

      // Показать блок с результатом
      document.getElementById('result').style.display = 'block';
    }
    
    // Заполнение формы данными из базы
    function fillFormWithMoldData(mold) {
      document.getElementById('material').value = mold.material;
      document.getElementById('length').value = mold.dimensions[0];
      document.getElementById('width').value = mold.dimensions[1];
      document.getElementById('height').value = mold.dimensions[2];
      document.getElementById('gnezda').value = mold.gnezda;
      document.getElementById('system').value = mold.system;
      document.getElementById('polzun').value = mold.polzun ? '1' : '0';
      document.getElementById('naklon').value = mold.naklon ? '1' : '0';
      document.getElementById('vivinch').value = mold.vivinch ? '1' : '0';
      document.getElementById('sriv').value = mold.sriv ? '1' : '0';
      document.getElementById('vytalk').value = mold.vytalk;
      
      showSuccess('Форма заполнена данными из базы');
    }
    
    // Сохранение в базу данных
    function saveToDatabase() {
      const password = document.getElementById('admin-password').value;
      if (password !== ADMIN_PASSWORD) {
        showError('Неверный пароль!');
        return;
      }

      // Сбор данных
      const name = document.getElementById('admin-name').value;
      const rfq = document.getElementById('admin-rfq').value;
      const gnezda = document.getElementById('admin-gnezda').value;
      const system = document.getElementById('admin-system').value;
      const dimensionsStr = document.getElementById('admin-dimensions').value;
      const material = document.getElementById('admin-material').value;
      const polzun = document.getElementById('admin-polzun').value === '1';
      const naklon = document.getElementById('admin-naklon').value === '1';
      const vivinch = document.getElementById('admin-vivinch').value === '1';
      const sriv = document.getElementById('admin-sriv').value === '1';
      const vytalk = document.getElementById('admin-vytalk').value;
      const cost = parseFloat(document.getElementById('admin-cost').value.replace(/\s+/g, '') || '0');
      const date = document.getElementById('admin-date').value || new Date().toISOString();

      // Проверка данных
      if (!name || !rfq || !gnezda || !system || !dimensionsStr || !material || isNaN(cost) || cost <= 0) {
        showError('Заполните все поля корректно!');
        return;
      }

      // Преобразование габаритов
      const dimensions = dimensionsStr.split(/[xх×]/).map(Number);
      if (dimensions.length !== 3 || dimensions.some(isNaN)) {
        showError('Габариты должны быть в формате: 350x450x450');
        return;
      }

      // Проверка дубликатов
      const isDuplicate = moldsDatabase.some(mold => 
        mold.name === name && 
        mold.rfq === rfq &&
        Math.abs(mold.cost - cost) < 1000
      );
      
      if (isDuplicate) {
        showWarning('Похожая запись уже существует в базе');
        return;
      }

      // Создание объекта
      const newMold = {
        name,
        rfq,
        gnezda,
        system,
        dimensions,
        material,
        polzun,
        naklon,
        vivinch,
        sriv,
        vytalk,
        cost,
        date
      };

      moldsDatabase.push(newMold);
      saveDatabase();
      showSuccess('Пресс-форма успешно добавлена в базу!');
      
      // Очистка формы
      document.getElementById('admin-name').value = '';
      document.getElementById('admin-cost').value = '';
    }
    
    // Конвертация валют
    function convertCurrency() {
      const amount = parseFloat(document.getElementById('from-amount').value);
      const currency = document.getElementById('from-currency').value;
      
      if (isNaN(amount) || amount <= 0) {
        showError('Введите корректную сумму для конвертации');
        return;
      }
      
      let result, resultText;
      
      if (currency === 'CNY') {
        result = amount * exchangeRate;
        resultText = `${amount.toLocaleString('ru-RU')} CNY = ${result.toLocaleString('ru-RU', {maximumFractionDigits: 2})} RUB`;
      } else {
        result = amount / exchangeRate;
        resultText = `${amount.toLocaleString('ru-RU')} RUB = ${result.toLocaleString('ru-RU', {maximumFractionDigits: 2})} CNY`;
      }
      
      document.getElementById('converter-result').innerHTML = `
        <div style="font-size: 1.8rem; margin-bottom: 10px;">${resultText}</div>
        <div class="converter-rate" id="exchange-rate">Текущий курс: 1 CNY = ${exchangeRate.toFixed(2)} RUB</div>
      `;
    }
    
    // Смена направления конвертации
    function swapCurrencies() {
      const currencySelect = document.getElementById('from-currency');
      currencySelect.value = currencySelect.value === 'CNY' ? 'RUB' : 'CNY';
    }
    
    // Инициализация
    window.onload = function() {
      initDatabase();
      
      // Загрузка курса валют
      const savedRate = localStorage.getItem('exchangeRate');
      if (savedRate) {
        exchangeRate = parseFloat(savedRate);
        document.getElementById('exchange-rate').textContent = `Текущий курс: 1 CNY = ${exchangeRate.toFixed(2)} RUB`;
      } else {
        updateExchangeRate();
      }
      
      // Автоматическое обновление курса
      setInterval(updateExchangeRate, 60 * 60 * 1000);
      
      // Сортировка результатов
      document.querySelectorAll('.sort-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('.sort-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          
          if (document.getElementById('result').style.display === 'block') {
            calculate();
          }
        });
      });
      
      // Подсказки
      document.querySelectorAll('.info-icon').forEach(icon => {
        icon.addEventListener('mouseover', function(e) {
          const tooltip = document.getElementById('tooltip');
          tooltip.textContent = this.dataset.tooltip;
          tooltip.style.display = 'block';
          tooltip.style.left = `${e.pageX + 10}px`;
          tooltip.style.top = `${e.pageY + 10}px`;
        });
        
        icon.addEventListener('mouseout', () => {
          document.getElementById('tooltip').style.display = 'none';
        });
      });
      
      // Автозаполнение даты
      document.getElementById('admin-date').value = new Date().toISOString().split('T')[0];
    };
  </script>
</body>
</html>
